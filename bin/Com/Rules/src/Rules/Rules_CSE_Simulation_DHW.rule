; -------------------------------------------------------------------------
; Rules pertaining to:   Prep For and Clean-up After each CSE Energy Simulation
; CEC Title-24 Residential Energy Code
; -------------------------------------------------------------------------
; Copyright (c) 2012-2014, California Energy Commission
; Copyright (c) 2012-2014, Wrightsoft Corporation
; All rights reserved.
; Redistribution and use in source and binary forms, with or without modification,
; are permitted provided that the following conditions are met:
; - Redistributions of source code must retain the above copyright notice, this
;   list of conditions and the following disclaimer.
; - Redistributions in binary form must reproduce the above copyright notice, this
;   list of conditions, the following disclaimer in the documentation and/or other
;   materials provided with the distribution.
; - Neither the name of the California Energy Commission nor the names of its
;   contributors may be used to endorse or promote products derived from this
;   software without specific prior written permission.
; DISCLAIMER: THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
; "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
; THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
; NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION,
; WRIGHTSOFT CORPORATION, ITRON, INC. OR ANY OTHER AUTHOR OR COPYRIGHT HOLDER OF
; THIS SOFTWARE (COLLECTIVELY, THE "AUTHORS") BE LIABLE FOR ANY DIRECT, INDIRECT,
; INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
; LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
; OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
; LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
; OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
; ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  EACH LICENSEE AND SUBLICENSEE OF THE
; SOFTWARE AGREES NOT TO ASSERT ANY CLAIM AGAINST ANY OF THE AUTHORS RELATING TO
; THIS SOFTWARE, WHETHER DUE TO PERFORMANCE ISSUES, TITLE OR INFRINGEMENT ISSUES,
; STRICT LIABILITY OR OTHERWISE.
; -------------------------------------------------------------------------


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering DHW objects only
;*************************************************************************

	"Delete all cseDHWLOOPPUMP components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPPUMP   )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPBRANCH components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPBRANCH )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPSEG components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPSEG    )  }	; SAC 10/21/15
	"Delete all cseDHWLOOP components"				Proj:Action = {	DeleteAllComps( cseDHWLOOP       )  }	; SAC 10/21/15
	"Delete all cseDHWHEATER components"			Proj:Action = {	DeleteAllComps( cseDHWHEATER     )  }
	"Delete all cseDHWSYS components"				Proj:Action = {	DeleteAllComps( cseDHWSYS        )  }
	"Delete all DwellUnitDHW components"			Proj:Action = {	DeleteAllComps( DwellUnitDHW     )  }	; SAC 5/11/16

	; SAC 4/25/16 - added creation of DHWMETER obejcts
	"Create site-wide FXHwDHWMETER"		Proj:CSE_FXHwDHWMETER	= {	if (CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED
																							else  CreateComp( cseDHWMETER, "DHWMtrFXMix" )  endif  }
	"Create site-wide WHHwDHWMETER"		Proj:CSE_WHHwDHWMETER	= {	if (CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED
																							else  CreateComp( cseDHWMETER, "DHWMtrWH" )  endif  }

;	Descriptions of DHW system types defined in the Res ACM, appendix E, section E1:
;	--------------------------------------------------------------------------------------------------------------------
;		1	One distribution system with one or multiple water heaters serving a single dwelling unit. The system might include
;			recirculation loops within the dwelling unit.  
;		2	Two water heaters with independent distribution systems serving a single dwelling unit. One or more of the
;			distribution systems may include a recirculation loop within the dwelling unit.  
;		3	One distribution system without recirculation loop and with one or multiple water heaters serving multiple
;			dwelling units.  
;		4	One distribution system with one or multiple recirculation loops and with one or multiple water heaters serving
;			multiple units.  
;	--------------------------------------------------------------------------------------------------------------------

  ; CSE DHWSYS creation & setup
	; SAC 10/26/15 - revised to create cseDHWSYS by ResDHWSys only for SFam, and (potentially multiple) cseDHWSys objects for each DwellUnitType for MFam
	"Create a CSE DHWSYS for each ResDHWSys"		ResDHWSys:cseDHWSYSRef					= {	if (IfValidAnd( SysFlrArea > 0.5 )==0 .OR. CentralSys < 0.5) then  UNCHANGED
																												else  CreateComp( cseDHWSYS, "dhwsys-" + Local( Name ) )  endif  }
	"Set ResDHWSys:cseDHWSYSRef:SourceDHWSys"		ResDHWSys:cseDHWSYSRef:SourceDHWSys	= {	Local( Name )  }

	"Call subordinate rulelist to setup MFam DHWSYS objects"		Proj:Action		= {	if (CSE_DHWUseMthd == "Old (via wsUse)")
																												then	EvalRulelist( "CSE_SimulationPrep_DHW_MFam_wsUse" )
																												else	EvalRulelist( "CSE_SimulationPrep_DHW_MFam_wsDayUse" )    endif  }

	"Call subordinate rulelist to complete setup of DHW objects"	Proj:Action	= {	EvalRulelist( "CSE_SimulationPrep_DHW_part2" )  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_Cleanup_DHW" 1 0 0 1
;*************************************************************************
	"Blast site-wide FXHwDHWMETER"		Proj:CSE_FXHwDHWMETER	= {	if (LocalCompAssigned( CSE_FXHwDHWMETER )) then  DeleteComp()  else  UNCHANGED  endif  }	; SAC 4/25/16
	"Blast site-wide WHHwDHWMETER"		Proj:CSE_WHHwDHWMETER	= {	if (LocalCompAssigned( CSE_WHHwDHWMETER )) then  DeleteComp()  else  UNCHANGED  endif  }

	"Delete all cseDHWLOOPPUMP components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPPUMP   )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPBRANCH components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPBRANCH )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPSEG components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPSEG    )  }	; SAC 10/21/15
	"Delete all cseDHWLOOP components"				Proj:Action = {	DeleteAllComps( cseDHWLOOP )  }	; SAC 10/21/15
	"Delete all cseDHWHEATER components"			Proj:Action = {	DeleteAllComps( cseDHWHEATER )  }	; SAC 7/6/15
	"Delete all cseDHWSYS components"				Proj:Action = {	DeleteAllComps( cseDHWSYS )  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SetDHWUseInclude" 1 0 0 1
	"Set Proj:CSE_DefineName[11]"		Proj:CSE_DefineName[11]		= { "ShwrFLOWF"		 }
	"Set Proj:CSE_DefineName[12]"		Proj:CSE_DefineName[12]		= { "ShwrDRAINHREFF"	 }
	"Set Proj:CSE_DefineName[13]"		Proj:CSE_DefineName[13]		= { "CwshHOTF"			 }
	"Set Proj:CSE_DefineName[14]"		Proj:CSE_DefineName[14]		= { "CwshUSEF"			 }
	"Set Proj:CSE_DefineName[15]"		Proj:CSE_DefineName[15]		= { "FaucHOTF"			 }
	"Set Proj:CSE_DefineName[16]"		Proj:CSE_DefineName[16]		= { "FaucFlowF"		 }
	"Set Proj:CSE_DefineName[17]"		Proj:CSE_DefineName[17]		= { "BathFLOWF"		 }
	"Set Proj:CSE_DefineName[18]"		Proj:CSE_DefineName[18]		= { "BathDRAINHREFF"	 }
	"Set Proj:CSE_DefineName[19]"		Proj:CSE_DefineName[19]		= { "DwshFLOWF"		 }
	"Set Proj:CSE_DefineName[20]"		Proj:CSE_DefineName[20]		= { UNDEFINED  }				; add next here
	"Set Proj:CSE_DefineName[21]"		Proj:CSE_DefineName[21]		= { UNDEFINED  }
	"Set Proj:CSE_DefineName[22]"		Proj:CSE_DefineName[22]		= { UNDEFINED  }
	"Set Proj:CSE_DefineName[23]"		Proj:CSE_DefineName[23]		= { UNDEFINED  }

	"Set Proj:CSE_DefineFloat[11]"	Proj:CSE_DefineFloat[11]	= { 1.0  }	; Proj:ShwrFLOWF		}
	"Set Proj:CSE_DefineFloat[12]"	Proj:CSE_DefineFloat[12]	= { 0    }	; Proj:ShwrDRAINHREFF	}
	"Set Proj:CSE_DefineFloat[13]"	Proj:CSE_DefineFloat[13]	= { 0.22 }	; Proj:CwshHOTF			}
	"Set Proj:CSE_DefineFloat[14]"	Proj:CSE_DefineFloat[14]	= { 2.03 }	; Proj:CwshUSEF			}
	"Set Proj:CSE_DefineFloat[15]"	Proj:CSE_DefineFloat[15]	= { 0.5  }	; Proj:FaucHOTF			}
	"Set Proj:CSE_DefineFloat[16]"	Proj:CSE_DefineFloat[16]	= { 1    }	; Proj:FaucFlowF		}
	"Set Proj:CSE_DefineFloat[17]"	Proj:CSE_DefineFloat[17]	= { 1    }	; Proj:BathFLOWF		}
	"Set Proj:CSE_DefineFloat[18]"	Proj:CSE_DefineFloat[18]	= { 0    }	; Proj:BathDRAINHREFF	}
	"Set Proj:CSE_DefineFloat[19]"	Proj:CSE_DefineFloat[19]	= { 1    }	; Proj:DwshFLOWF		}
	"Set Proj:CSE_DefineFloat[20]"	Proj:CSE_DefineFloat[20]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[21]"	Proj:CSE_DefineFloat[21]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[22]"	Proj:CSE_DefineFloat[22]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[23]"	Proj:CSE_DefineFloat[23]	= { UNDEFINED  }

	"Set Proj:CSE_DefineType[11]"		Proj:CSE_DefineType[11]		= {	1  }
	"Set Proj:CSE_DefineType[12]"		Proj:CSE_DefineType[12]		= {	1  }
	"Set Proj:CSE_DefineType[13]"		Proj:CSE_DefineType[13]		= {	1  }
	"Set Proj:CSE_DefineType[14]"		Proj:CSE_DefineType[14]		= {	1  }
	"Set Proj:CSE_DefineType[15]"		Proj:CSE_DefineType[15]		= {	1  }
	"Set Proj:CSE_DefineType[16]"		Proj:CSE_DefineType[16]		= {	1  }
	"Set Proj:CSE_DefineType[17]"		Proj:CSE_DefineType[17]		= {	1  }
	"Set Proj:CSE_DefineType[18]"		Proj:CSE_DefineType[18]		= {	1  }
	"Set Proj:CSE_DefineType[19]"		Proj:CSE_DefineType[19]		= {	1  }
	"Set Proj:CSE_DefineType[20]"		Proj:CSE_DefineType[20]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[21]"		Proj:CSE_DefineType[21]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[22]"		Proj:CSE_DefineType[22]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[23]"		Proj:CSE_DefineType[23]		= {	UNDEFINED  }
END

RULELIST "CSE_BlastDHWUseInclude" 1 0 0 1
	"Blast Proj:CSE_DefineName[11]"		Proj:CSE_DefineName[11]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[12]"		Proj:CSE_DefineName[12]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[13]"		Proj:CSE_DefineName[13]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[14]"		Proj:CSE_DefineName[14]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[15]"		Proj:CSE_DefineName[15]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[16]"		Proj:CSE_DefineName[16]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[17]"		Proj:CSE_DefineName[17]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[18]"		Proj:CSE_DefineName[18]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[19]"		Proj:CSE_DefineName[19]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[20]"		Proj:CSE_DefineName[20]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[21]"		Proj:CSE_DefineName[21]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[22]"		Proj:CSE_DefineName[22]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[23]"		Proj:CSE_DefineName[23]		= { UNDEFINED  }

	"Blast Proj:CSE_DefineFloat[11]"		Proj:CSE_DefineFloat[11]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[12]"		Proj:CSE_DefineFloat[12]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[13]"		Proj:CSE_DefineFloat[13]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[14]"		Proj:CSE_DefineFloat[14]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[15]"		Proj:CSE_DefineFloat[15]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[16]"		Proj:CSE_DefineFloat[16]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[17]"		Proj:CSE_DefineFloat[17]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[18]"		Proj:CSE_DefineFloat[18]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[19]"		Proj:CSE_DefineFloat[19]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[20]"		Proj:CSE_DefineFloat[20]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[21]"		Proj:CSE_DefineFloat[21]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[22]"		Proj:CSE_DefineFloat[22]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[23]"		Proj:CSE_DefineFloat[23]	= { UNDEFINED  }

	"Blast Proj:CSE_DefineType[11]"		Proj:CSE_DefineType[11]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[12]"		Proj:CSE_DefineType[12]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[13]"		Proj:CSE_DefineType[13]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[14]"		Proj:CSE_DefineType[14]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[15]"		Proj:CSE_DefineType[15]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[16]"		Proj:CSE_DefineType[16]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[17]"		Proj:CSE_DefineType[17]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[18]"		Proj:CSE_DefineType[18]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[19]"		Proj:CSE_DefineType[19]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[20]"		Proj:CSE_DefineType[20]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[21]"		Proj:CSE_DefineType[21]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[22]"		Proj:CSE_DefineType[22]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[23]"		Proj:CSE_DefineType[23]		= {	UNDEFINED  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_MFam_wsUse" 1 0 0 1
;   Rules to setup DHWSYS objects using old (2013 and earlier) DHW use & gains mechanism
;*************************************************************************
	; unlike in 2016/wsDayUse mode, we create only a single DwellUnitDHW per Spc/DUBedrm combination, since there is no need to vary DHW use schedules across <count> of Spc/DUBedrm DHW systems
	; SAC 8/18/16 - revised logic to NOT create Spc DwellUnitDHW children when the Spc is served by a central ResDHWSys
	"Create Studio DwellUnitDHW child for each Spc"		Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[1] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 1] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU0", "Setup_DwellUnitDHW_Studio" )  endif  }
	"Create 1-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[2] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 2] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU1", "Setup_DwellUnitDHW_1Bedroom" )  endif  }
	"Create 2-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[3] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 3] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU2", "Setup_DwellUnitDHW_2Bedroom" )  endif  }
	"Create 3-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[4] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 4] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU3", "Setup_DwellUnitDHW_3Bedroom" )  endif  }
	"Create 4-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[5] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 5] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU4", "Setup_DwellUnitDHW_4Bedroom" )  endif  }
	"Create 5-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[6] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 6] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU5", "Setup_DwellUnitDHW_5Bedroom" )  endif  }

	"Create a CSE DHWSYS for each DwellUnitDHW"				DwellUnitDHW:cseDHWSYSRef								= {	CreateComp( cseDHWSYS, "dhwsys-" + Local( Name ) )  }
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitType"	DwellUnitDHW:cseDHWSYSRef:SourceSpc					= {	Parent( Name )  }
; SAC 5/11/16 - DISALLOW multiple ResDHWSys objects per DwellUnitType
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDHWSys"				DwellUnitDHW:cseDHWSYSRef:SourceDHWSys				= {	ParentRef( ResDHWSysRef:Name )  }
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW"		DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW		= {	Name  }

	"Set DwellUnitDHW:cseDHWSYSRef:wsMult"						DwellUnitDHW:cseDHWSYSRef:wsMult						= {	Mult  }
	"Set DwellUnitDHW:cseDHWSYSRef:DHWDailyConsPerSys"		DwellUnitDHW:cseDHWSYSRef:DHWDailyConsPerSys		= {	UsePerDay  }
	"Set DwellUnitDHW:cseDHWSYSRef:CFAk"						DwellUnitDHW:cseDHWSYSRef:CFAk						= {	Area  }

; SAC 7/7/16 - replaced below w/ above to fix problem where cseDHWHEATER objects not being created for 2013/wsUse models
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-1"		DwellUnitType:cseDHWSYSRefs[1]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 1 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[1] ) < 1) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys1-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[1]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[1]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[1]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[1]:SourceDHWSys			= {	DHWSysRef[1]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[1]:wsMult"					DwellUnitType:cseDHWSYSRefs[1]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-Studio"			Spc:CSE_DHWSYSRefs[1]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[1] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 1] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys0-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[1]:SourceSpc"				Spc:CSE_DHWSYSRefs[1]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[1]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[1]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[1]:wsMult"					Spc:CSE_DHWSYSRefs[1]:wsMult					= {	DwellingUnitTypeCnt[1] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[1]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[1]:DHWDailyConsPerSys	= {	DwellingUnit1GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[1]:CFAk"						Spc:CSE_DHWSYSRefs[1]:CFAk						= {	DwellingUnitTypeArea[1]  }
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-2"		DwellUnitType:cseDHWSYSRefs[2]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 2 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[2] ) < 0.5) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys2-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[2]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[2]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[2]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[2]:SourceDHWSys			= {	DHWSysRef[2]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[2]:wsMult"					DwellUnitType:cseDHWSYSRefs[2]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-1 Bedrm"		Spc:CSE_DHWSYSRefs[2]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[2] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 2] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys1-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[2]:SourceSpc"				Spc:CSE_DHWSYSRefs[2]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[2]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[2]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[2]:wsMult"					Spc:CSE_DHWSYSRefs[2]:wsMult					= {	DwellingUnitTypeCnt[2] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[2]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[2]:DHWDailyConsPerSys	= {	DwellingUnit2GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[2]:CFAk"						Spc:CSE_DHWSYSRefs[2]:CFAk						= {	DwellingUnitTypeArea[2]  }
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-3"		DwellUnitType:cseDHWSYSRefs[3]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 3 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[3] ) < 0.5) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys3-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[3]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[3]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[3]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[3]:SourceDHWSys			= {	DHWSysRef[3]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[3]:wsMult"					DwellUnitType:cseDHWSYSRefs[3]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-2 Bedrm"		Spc:CSE_DHWSYSRefs[3]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[3] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 3] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys2-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[3]:SourceSpc"				Spc:CSE_DHWSYSRefs[3]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[3]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[3]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[3]:wsMult"					Spc:CSE_DHWSYSRefs[3]:wsMult					= {	DwellingUnitTypeCnt[3] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[3]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[3]:DHWDailyConsPerSys	= {	DwellingUnit3GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[3]:CFAk"						Spc:CSE_DHWSYSRefs[3]:CFAk						= {	DwellingUnitTypeArea[3]  }
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-4"		DwellUnitType:cseDHWSYSRefs[4]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 4 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[4] ) < 0.5) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys4-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[4]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[4]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[4]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[4]:SourceDHWSys			= {	DHWSysRef[4]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[4]:wsMult"					DwellUnitType:cseDHWSYSRefs[4]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-3 Bedrm"		Spc:CSE_DHWSYSRefs[4]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[4] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 4] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys3-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[4]:SourceSpc"				Spc:CSE_DHWSYSRefs[4]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[4]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[4]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[4]:wsMult"					Spc:CSE_DHWSYSRefs[4]:wsMult					= {	DwellingUnitTypeCnt[4] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[4]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[4]:DHWDailyConsPerSys	= {	DwellingUnit4GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[4]:CFAk"						Spc:CSE_DHWSYSRefs[4]:CFAk						= {	DwellingUnitTypeArea[4]  }
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-5"		DwellUnitType:cseDHWSYSRefs[5]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 5 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[5] ) < 0.5) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys5-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[5]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[5]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[5]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[5]:SourceDHWSys			= {	DHWSysRef[5]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[5]:wsMult"					DwellUnitType:cseDHWSYSRefs[5]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-4 Bedrm"		Spc:CSE_DHWSYSRefs[5]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[5] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 5] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys4-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[5]:SourceSpc"				Spc:CSE_DHWSYSRefs[5]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[5]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[5]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[5]:wsMult"					Spc:CSE_DHWSYSRefs[5]:wsMult					= {	DwellingUnitTypeCnt[5] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[5]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[5]:DHWDailyConsPerSys	= {	DwellingUnit5GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[5]:CFAk"						Spc:CSE_DHWSYSRefs[5]:CFAk						= {	DwellingUnitTypeArea[5]  }
;	
;		"Create a CSE DHWSYS for each Spc-5 Bedrm"		Spc:CSE_DHWSYSRefs[6]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[6] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 6] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys5-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[6]:SourceSpc"				Spc:CSE_DHWSYSRefs[6]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[6]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[6]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[6]:wsMult"					Spc:CSE_DHWSYSRefs[6]:wsMult					= {	DwellingUnitTypeCnt[6] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[6]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[6]:DHWDailyConsPerSys	= {	DwellingUnit6GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[6]:CFAk"						Spc:CSE_DHWSYSRefs[6]:CFAk						= {	DwellingUnitTypeArea[6]  }
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_MFam_wsDayUse" 1 0 0 1
;   Rules to setup DHWSYS objects using new (2016 and later) DHW use & gains mechanism
;*************************************************************************
;	"Create DwellUnitDHW children for each DwellUnit"	DwellUnit:Action	= {	if (LocalCompAssigned( DwellUnitTypeRef ) < 1 .OR. Count < 1 .OR.
;																											 LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[1] ) < 1) then  UNCHANGED
;																										else	CreateChildren( DwellUnitDHW, Count, Name + " DU" )  endif  }
;																					;					else	CreateChildren( DwellUnitDHW, Count, Name + " DU", "Setup_DwellUnitDHW", 1 )  endif  }
; SAC 9/17/16 - removed condition "IfValidAnd( ResDHWSysRef:CentralSys > 0 )" preventing creation of DwellUnitDHW for spaces served by central DHW systems
	"Create Studio DwellUnitDHW children for each Spc"		Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[1] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 1] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 1] * Mult, Name + " DU0", "Setup_DwellUnitDHW_Studio" )  endif  }
	"Create 1-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[2] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 2] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 2] * Mult, Name + " DU1", "Setup_DwellUnitDHW_1Bedroom" )  endif  }
	"Create 2-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[3] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 3] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 3] * Mult, Name + " DU2", "Setup_DwellUnitDHW_2Bedroom" )  endif  }
	"Create 3-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[4] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 4] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 4] * Mult, Name + " DU3", "Setup_DwellUnitDHW_3Bedroom" )  endif  }
	"Create 4-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[5] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 5] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 5] * Mult, Name + " DU4", "Setup_DwellUnitDHW_4Bedroom" )  endif  }
	"Create 5-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[6] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 6] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 6] * Mult, Name + " DU5", "Setup_DwellUnitDHW_5Bedroom" )  endif  }

	"Create a CSE DHWSYS for each DwellUnitDHW"				DwellUnitDHW:cseDHWSYSRef								= {	CreateComp( cseDHWSYS, "dhwsys-" + Local( Name ) )  }
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitType"	DwellUnitDHW:cseDHWSYSRef:SourceSpc					= {	Parent( Name )  }
; SAC 5/11/16 - DISALLOW multiple ResDHWSys objects per DwellUnitType
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDHWSys"				DwellUnitDHW:cseDHWSYSRef:SourceDHWSys				= {	ParentRef( ResDHWSysRef:Name )  }
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW"		DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW		= {	Name  }

	"Set DwellUnitDHW:cseDHWSYSRef:wsCentralDHWSYS"			DwellUnitDHW:cseDHWSYSRef:wsCentralDHWSYS			= {	if (IfValidAnd( cseDHWSYSRef:SourceDHWSys:CentralSys > 0.5 ))
																																					then	cseDHWSYSRef:SourceDHWSys:cseDHWSYSRef
																																					else	UNDEFINED  endif  }
END

;*************************************************************************
RULELIST "Setup_DwellUnitDHW_Studio" 1 0 0 0
	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	0  }	; SAC 5/30/16 - added .._Init properties to ensure DHWProfileLetter set properly
	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[1] )  }
	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[1] ) * Parent( Mult )  else  UNDEFINED  endif  }
	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit1GalPerDay )  else  UNDEFINED  endif  }
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_1Bedroom" 1 0 0 0
	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	1  }
	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[2] )  }
	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[2] ) * Parent( Mult )  else  UNDEFINED  endif  }
	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit2GalPerDay )  else  UNDEFINED  endif  }
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_2Bedroom" 1 0 0 0
	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	2  }
	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[3] )  }
	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[3] ) * Parent( Mult )  else  UNDEFINED  endif  }
	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit3GalPerDay )  else  UNDEFINED  endif  }
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_3Bedroom" 1 0 0 0
	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	3  }
	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[4] )  }
	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[4] ) * Parent( Mult )  else  UNDEFINED  endif  }
	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit4GalPerDay )  else  UNDEFINED  endif  }
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_4Bedroom" 1 0 0 0
	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	4  }
	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[5] )  }
	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[5] ) * Parent( Mult )  else  UNDEFINED  endif  }
	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit5GalPerDay )  else  UNDEFINED  endif  }
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_5Bedroom" 1 0 0 0
	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	5  }
	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[6] )  }
	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[6] ) * Parent( Mult )  else  UNDEFINED  endif  }
	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit6GalPerDay )  else  UNDEFINED  endif  }
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
;*************************************************************************

;*************************************************************************
RULELIST "Setup_DwellUnitDHW" 1 0 0 0
;   Rules to setup newly created DwellUnitDHW objects
;	"Set DwellUnitDHW:DwellUnitTypeRef"		DwellUnitDHW:DwellUnitTypeRef		= {	Parent( DwellUnitTypeRef )  }
;	"Set DwellUnitDHW:NumBedrooms"			DwellUnitDHW:NumBedrooms			= {	if (     IfValidAnd( DwellUnitTypeRef:NumBedrooms > 4.5 )) then  5
;																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 3.5 )) then  4
;																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 2.5 )) then  3
;																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 1.5 )) then  2
;																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 0.5 )) then  1
;																											else	0  endif endif endif endif endif  }
	"Set DwellUnitDHW:NumBedrooms"			DwellUnitDHW:NumBedrooms			= {	NumBedrooms_Init  }
	"Set DwellUnitDHW:DHWProfileLetter"		DwellUnitDHW:DHWProfileLetter		= {	switch ( mod( CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ), 5 ) )
																												case  1 :  "a"
																												case  2 :  "b"
																												case  3 :  "c"
																												case  4 :  "d"
																												default :  "e"
																											endswitch  }
;	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHW%.0fBR", NumBedrooms )  }								; PRIOR to MFam central DHW fixes ~5/12/16
	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHW%.0fBR%s", NumBedrooms, DHWProfileLetter )  }	; PRIOR to MFam central DHW fixes ~5/12/16
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_part2" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering DHW objects only
;*************************************************************************

	"Set ResDHWSys:HWSupplyTemp"			ResDHWSys:HWSupplyTemp		= {	; based on Res ACM App E, Eqn RE-3 description of HW supply temp, combined w/ ACM system types described above
																				;		if (Proj:IsMultiFamily > 0.5 .AND. CentralDHW > 0.5)		; SAC 5/20/16 - removed MFam central dependence (per BAW 
																				;		then  130  else
																						if (Proj:CSE_DHWUseMthd == "Old (via wsUse)")
																						then	124  else  115  endif  }		; SAC 4/6/16 - non-MFam/central switched from 124 to 115		; SAC 4/15/16 - restored 124 for old/2013 models (tic #641)

	"Setup cseDHWSYS meters and temperatures"		cseDHWSYS:Action	= {	if (LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																								else	EvalRulelist( "Setup_cseDHWSYS_MetersAndTemperatures", 1 )  endif  }

; THE FOLLOWING RULE SERVES TO RE-DISTRIBUTE ALL PROJECT HW CONSUMPTION EVENLY ACROSS ALL SIMULATED ResDHWSys OBJECTS
; REMOVE THIS RULE TO SIMULATE HW CONSUMPTION BY ResDHWSys BASED ON Zone/DwellUnitType SIZES/COUNTS
; SAC 10/24/15 - removed this rule to split DHW load based on dwelling units & area served
; SAC 10/26/15 - following rule WILL NOT WORK AGAIN for MFam, non-central systems, as these systems don't rely on this global parameter
;				"Re-allocate ResDHWSys:DailyHWConsumption"	ResDHWSys:DailyHWConsumption	= {	if (SumAll( ResDHWSys:SimDHWSys ) < 0.5)	then  UNCHANGED
;																													else	Proj:DailyHWConsumption / SumAll( ResDHWSys:SimDHWSys )  endif  }
; SAC 8/18/16 - new rule setting same parameter as above in order to calculate total load on CENTRAL systems only
   "Set ResDHWSys:DailyHWConsumption"	ResDHWSys:DailyHWConsumption	= {
      if (IfValidAnd( CentralSys > 0.5 )==0)	then  UNDEFINED
      else  SumRevRef( Spc:ResDHWSysRef, Spc:ResSpcHtWtrTotGalPerDayXMult )  endif  }

	"Set cseDHWSYS:HWUse - HW use"		cseDHWSYS:HWUse		= {	if (IfValidAnd( DHWDailyConsPerSys > 0 ))
																						then	DHWDailyConsPerSys
																						else if (LocalCompAssigned( SourceDHWSys ) > 0.5 .AND.
																						         IfValidAnd( SourceDHWSys:DailyHWConsumption > 0 ))
																						then	SourceDHWSys:DailyHWConsumption
																						else	0  endif endif  }
	;; SAC 9/1/15 - adjustment added per input from Chip:
	;; 		Hot Water Factor for 2013 RACM modifies gallons/day                                        ;
	;; 		 accounts for reduced waste for single-family recirculating systems                        ;
	;; 		 per Marc Hoeshele 22 Oct 2012                                                             ;
	;; 		HWF = 1.0 for non-recirculating or 0.9 for single-family recirculating                     ;
	;			"Adjust cseDHWSYS:HWUse for single family recirculation"
	;					cseDHWSYS:HWUse	= {	if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNCHANGED
	;													else	switch ( SourceDHWSys:SystemType )
	;																case    4992 :  HWUse * 0.9		; "Recirculation, Non-Demand Control"                          
	;																case    5248 :  HWUse * 0.9		; "Recirculation, Demand Control Push Button"                  
	;																case    5504 :  HWUse * 0.9		; "Recirculation, Demand Control Occupancy/Motion"             
	;																case 8393856 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Push Button"     
	;																case 8394112 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion"
	;																default      :  UNCHANGED
	;															endswitch  endif  }
	; SAC 3/17/16 - replaced above rule which applied waste factor to HWUSE with below that passes that factor directly into the DHWSYS via the new wsWF property
				"Set cseDHWSYS:wsWF (waste factor)"
						cseDHWSYS:wsWF		= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED			; SAC 4/15/16 - prevent specification for old/2013 models (tic #641)
														else if (IfValidAnd( SourceDHWSys:CentralSys > 0.5 ) .AND.
																	LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNDEFINED		; SAC 5/12/16 - no wsWF for DayUse central DHWSYSs
														else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  1.0
														else	switch ( SourceDHWSys:Type )
																	case    4992 :  0.9		; "Recirculation, Non-Demand Control"                          
																	case    5248 :  0.9		; "Recirculation, Demand Control Push Button"                  
																	case    5504 :  0.9		; "Recirculation, Demand Control Occupancy/Motion"             
																	case 8393856 :  0.9		; "(HERS req'd) Recirculation, Demand Control Push Button"     
																	case 8394112 :  0.9		; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion"
																	default      :  1.0
																endswitch  endif endif endif  }

	;; SAC 9/1/15 - adjustment added per input from Chip:
	; SAC 8/16/16 - RESTORE adjustment (after being removed 3/17/16) of HW use when simulating DHW use via wsUse (old/2013 method):
	; 		Hot Water Factor for 2013 RACM modifies gallons/day                                        ;
	; 		 accounts for reduced waste for single-family recirculating systems                        ;
	; 		 per Marc Hoeshele 22 Oct 2012                                                             ;
	; 		HWF = 1.0 for non-recirculating or 0.9 for single-family recirculating                     ;
				"Adjust cseDHWSYS:HWUse for single family recirculation (when Proj:CSEDHWUseMethod == 'Old (via wsUse)')"
						cseDHWSYS:HWUse	= {	if (Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNCHANGED
														else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNCHANGED
														else	switch ( SourceDHWSys:Type )
																	case    4992 :  HWUse * 0.9		; "Recirculation, Non-Demand Control"                          
																	case    5248 :  HWUse * 0.9		; "Recirculation, Demand Control Push Button"                  
																	case    5504 :  HWUse * 0.9		; "Recirculation, Demand Control Occupancy/Motion"             
																	case 8393856 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Push Button"     
																	case 8394112 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion"
																	default      :  UNCHANGED
																endswitch  endif endif  }

	; SAC 3/17/16 - added logic for Proj:CSE_DHWUseMthd
	"Set cseDHWSYS:wsUse_x"				cseDHWSYS:wsUse_x	= {	if (Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNDEFINED
																				else	Format( "%g * select( $isWeekend, HWUSEF_WE, default HWUSEF_WD )", HWUse )  endif  }
	; SAC 3/17/16 - new wsDayUse property
	"Set cseDHWSYS:wsDayUse_x"			cseDHWSYS:wsDayUse_x	= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED
																					else if (LocalCompAssigned( SourceDwellUnitDHW ) > 0) then  SourceDwellUnitDHW:CSEDayUseName
																;					else if (Proj:IsMultiFamily < 0.5)
																;					then	if (     Proj:SimNumBedrooms < 1.5) then "DHW1BR"
																;							else if (Proj:SimNumBedrooms < 2.5) then "DHW2BR"
																;							else if (Proj:SimNumBedrooms < 3.5) then "DHW3BR"
																;							else if (Proj:SimNumBedrooms < 4.5) then "DHW4BR"
																;							else                                     "DHW5BR"
																;							endif endif endif endif
																					else	UNDEFINED  endif endif  }
																		; SAC 5/12/16 - ALL MFam DayUse assignments handled via DwellUnitDHW assignment above
																		;			else if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																		;			then	if (     SourceDwellUnitType:NumBedrooms < 0.5) then "DHW0BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 1.5) then "DHW1BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 2.5) then "DHW2BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 3.5) then "DHW3BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 4.5) then "DHW4BR"
																		;					else                                                 "DHW5BR"
																		;					endif endif endif endif endif
																		;			else	UNDEFINED  endif endif endif  }

  ; delta-T and other formulas related to calculation of (simulation) energy factor by water heater
;	"Set Proj:InletMainsWtrTemp"		Proj:InletMainsWtrTemp	= {	CAClimateZoneInletMainsTemp:InletTemp( "ClimateZone", Proj:CliZnNum )  }
;	"Set ResDHWSys:HWDeltaTemp"		ResDHWSys:HWDeltaTemp	= {	if (IfValidAnd( Proj:InletMainsWtrTemp > 0 )==0) then  10		; ERROR
;																						else  HWSupplyTemp - Proj:InletMainsWtrTemp  endif  }
	"Set ResDHWSys:HWDeltaTemp"		ResDHWSys:HWDeltaTemp	= {	if (IfValidAnd( Proj:CliZnNum >= 1 )==0 .OR. IfValidAnd( Proj:CliZnNum <= 16 )==0) then  10		; ERROR
																						else  HWSupplyTemp - CAClimateZoneInletMainsTemp:InletTemp( "ClimateZone", Proj:CliZnNum )  endif  }

;	; SAC 10/27/15 - fix problem where ResDHWSys:NumAssignedDUFracs not taking into account number of assigned DwellUnits of each DwellUnitType
;	"Set DwellUnitType:NumDUsSrvdPerDHWSys"	DwellUnitType:NumDUsSrvdPerDHWSys	= {	DHWSysAssignFrac * NumAssigningDUs  }
;	"Set ResDHWSys:NumAssignedDUFracs"		ResDHWSys:NumAssignedDUFracs	= {	;if (Proj:IsMultiFamily < 0.5) then  Proj:NumDwellingUnits
;																										SumRevRef( DwellUnitType:DHWSysRef[1], DwellUnitType:NumDUsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[2], DwellUnitType:NumDUsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[3], DwellUnitType:NumDUsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[4], DwellUnitType:NumDUsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[5], DwellUnitType:NumDUsSrvdPerDHWSys ) 
;																								endif  }

; REVISE THIS RULE TO REFERENCE SERVED CFA, # HEATERS & # DWELLING UNITS FOR MORE SYSTEM-SPECIFIC CFAk VALUE
	; SAC 10/12/15 - revised rule to remove dependence on # DHW heaters and add dependence on # systems (serving same area)
	"Set cseDHWSYS:CFAk - defined in Res ACM, equation RE-5, used to calc SDLMk (std distrib loss mult)"
																cseDHWSYS:CFAk		= {	if (IfValidAnd( SourceDHWSys:CentralSys > 0 ) .AND.
																									 IfValidAnd( SourceDHWSys:SysFlrArea > 0 ) .AND.
																									 LocalCompAssigned( wsCentralDHWSYS ) < 1)			; should cover all Central systems
																								then	SourceDHWSys:SysFlrArea
																								else if (IfValidAnd( SourceDwellUnitDHW:Area > 0 ))	; covers non-central, 2016 (wsDayUse) systems
																								then	SourceDwellUnitDHW:Area
																								else if (LocalStatus( CFAk ) > 0)		; for non-central, 2013 (wsUse) systems, this is set above in CSE_SimulationPrep_DHW_MFam_wsUse
																								then	UNCHANGED
																								else	0  endif endif endif  }
																				;				if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																				;				then	SourceDwellUnitType:CondFlrArea
																				;				else if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																				;				then	if (IfValidAnd( SourceDHWSys:NumAssignedDUFracs > 0 ))
                                                            ;;                  then  SourceDHWSys:FloorAreaServed[1] / SourceDHWSys:NumAssignedDUFracs
                                                            ;; SAC 7/27/16 - replaced above w/ below to ensure consistent wsSDLM for DHYSYS objects where multiple systems serve SFam home (tic #711)
                                                            ;                  then  SumAll( Zone:DHWFloorArea )
																				;						else	0  endif
																				;				else	0  endif endif  }		; error if = 0
																						; was (prior to 10/26/15):
																						;						else if (Proj:IsMultiFamily > 0.5 .AND. CentralDHW > 0.5 .AND. Proj:NumDwellingUnits > 0)
																						;						then	SumAll( ResDHWSys:FloorAreaServed[1] ) / Proj:NumDwellingUnits
																						;				;		else if (SumAcrossIf( ResDHWSys:NumDHWHeaters, ResDHWSys:SimDHWSys > 0.5 ) > 0.5)
																						;				;		then	SumAll( ResDHWSys:FloorAreaServed[1] ) / SumAcrossIf( ResDHWSys:NumDHWHeaters, ResDHWSys:SimDHWSys > 0.5 )
																						;						else if (IfValidAnd( ResDHWSys:FloorAreaServed[1] > 0.5 ) .AND. SumAll( ResDHWSys:SimDHWSys ) > 0.5)
																						;						then	SumAll( ResDHWSys:FloorAreaServed[1] ) / SumAll( ResDHWSys:SimDHWSys )
																						;						else	0  endif endif  }		; error if = 0

	; SAC 10/12/15 - added 'min( ..., 2500 )' to forumla (based on e-mail from BAW)
	"Set cseDHWSYS:wsSDLM - Standard distribution loss multiplier (refer to Res ACM App E, eqn RE-5)"
										cseDHWSYS:wsSDLM		= {	if (IfValidAnd( SourceDHWSys:CentralSys > 0.5 ) .AND.
																				 LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNDEFINED		; SAC 5/12/16 - no wsSDLM for central DHWSYSs
																			else	1.004 + (0.000202 * min( CFAk, 2500 )) -
																							  (0.0000000231 * min( CFAk, 2500 ) * min( CFAk, 2500 ))    endif  }
;										ResDHWSys:cseDHWSYSRef:wsSDLM		= {	1.1829  }  ; DEBUGGING  1.004 + (0.000202 * cseDHWSYSRef:CFAk) - (0.0000000231 * cseDHWSYSRef:CFAk * cseDHWSYSRef:CFAk)  }
                                                            
	"Set cseDHWSYS:HrlyStdEndUse"		cseDHWSYS:HrlyStdEndUse		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																							then	8.345 * HWUse * SourceDHWSys:HWDeltaTemp / 24
																							else	0  endif  }


	; SAC 9/1/15 - updated DSMs for single family recirculation systems per Marc Hoeschle 22 October 2013     ;
	; Recirculation non-demand control                      9.00   was 7.0                              ;
	; Recirculation demand control, push button             1.60   was 1.15                             ;
	; Recirculation demand control, occupancy/motion        2.40   was 1.3                              ;
	; Recirculation demand control, push button HERS        1.45   was 1.05                             ;
	; Recirculation demand control, occupancy/motion HERS   2.20   was 1.2                              ;
	"Set ResDHWSys:DistribSysMult - Distribution system multiplier (ACM App R, Table B-2)"
						ResDHWSys:DistribSysMult	= {	switch (Type)
																	case     3840 :	1.0	; "Standard"                                                    ; %WHDIST2013_STD =       
																	case     4096 :	0.9	; "Pipe Insulation, All Lines"                                  ; %WHDIST2013_PIA =       
																	case     4352 :	1.4	; "Insulated and Protected Pipe Below Grade"                    ; %WHDIST2013_IPBG =      
																	case     4608 :	1.05	; "Parallel Piping"                                             ; %WHDIST2013_PP =        
																	case     4992 :	9.0	; "Recirculation, Non-Demand Control"                           ; %WHDIST2013_RND =       
																	case     5248 :	1.6	; "Recirculation, Demand Control Push Button"                   ; %WHDIST2013_RDMan =     
																	case     5504 :	2.4	; "Recirculation, Demand Control Occupancy/Motion"              ; %WHDIST2013_RDAuto =    
														;			case  8388608 :	0.0	; ""                                                            ; %HERS_REQUIRED =        
																	case  8392704 :	0.8	; "(HERS req'd) Pipe Insulation, All Lines"                     ; %WHDIST2013_HERSPIA =   
														;			case  8392960 :	0.0	; "(HERS req'd) Insulated and Protected Pipe Below Grade"       ; %WHDIST2013_HERSIPBG =  
																	case  8393216 :	0.95	; "(HERS req'd) Parallel Piping"                                ; %WHDIST2013_HERSPP =    
														;			case  8393600 :	0.0	; "(HERS req'd) Recirculation, Non-Demand Control"              ; %WHDIST2013_HERSRND =   
																	case  8393856 :	1.45	; "(HERS req'd) Recirculation, Demand Control Push Button"      ; %WHDIST2013_HERSRDMan = 
																	case  8394112 :	2.2	; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion" ; %WHDIST2013_HERSRDAuto =
																	case  8394240 :	0.3	; "(HERS req'd) Point of Use"                                   ; %WHDIST2013_HERSPOU =   
																	case  8394496 :	0.7	; "(HERS req'd) Compact Distribution System"                    ; %WHDIST2013_HERSCDS =   
														;			case     5056 :	0.0	; "Multi-Family Central Recirc Non-Demand Control"              ; %WHDIST2013_CRND =      
														;			case     6336 :	0.0	; "Multi-Family Central Recirc Monitoring"                      ; %WHDIST2013_CRM =       
														;			case     6592 :	0.0	; "Multi-Family Central Demand Recirc (new cons std design)"    ; %WHDIST2013_CRD =       
																	default       :	1.0
																endswitch  }
	"Set cseDHWSYS:wsDSM - Distribution system multiplier (ACM App R, Table B-2)"
						cseDHWSYS:wsDSM	= {	if (IfValidAnd( SourceDHWSys:CentralSys > 0.5 ) .AND.
															 LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNDEFINED		; SAC 5/12/16 - no wsDSM for central DHWSYSs
														else	if (LocalCompAssigned( SourceDHWSys ) > 0.5) then  SourceDHWSys:DistribSysMult  else  1.0  endif endif  }

;	"Set cseDHWSYS:DistribLossMult"		cseDHWSYS:DistribLossMult		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5 .AND. LocalStatus( wsSDLM ) > 0)
;																									then	1 + ((wsSDLM - 1) * SourceDHWSys:DistribSysMult)
;																									else	1.0  endif  }

// TO DO - account for Monthly solar fractions ??
// TO DO - add in HRDLk (hourly recirculation distribution loss (btu))
;	"Set cseDHWSYS:HrlyAdjRecovLoad"		cseDHWSYS:HrlyAdjRecovLoad		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5)
;																									then	if (IfValidAnd( SourceDHWSys:SolFracType > 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracAnnRpt > 0)==0)
;																											then	(HrlyStdEndUse * DistribLossMult) 
;																											else	(HrlyStdEndUse * DistribLossMult) -
;																													(HrlyStdEndUse * SourceDHWSys:SolFracAnnRpt) 
;																											endif
;																									else	0  endif  }		; 0 => error

	; electrical parasitic power representing recirculation pump energy use - only when DHWCalcMethod = "CSE"
	; SAC 10/29/15 - revised logic to INSTALL wsParElec in T24-match mode (was previsouly turned OFF) - but do so w/ a 0.1 multiplier, since T24DHW DLL seems to calculate pump elec @ only 10% of what it should be
	"Set cseDHWSYS:wsParElec"		cseDHWSYS:wsParElec		= {	UNDEFINED  }  ; if (Proj:IsMultiFamily > 0.5 .OR. IfValidAnd( SourceDHWSys:Type = 4992 )==0) then  UNDEFINED
															;						else if (Proj:DHWCalcMthd == "CSE")		; straight CSE
															;						then	40			; 40 Watts continual use for SFam where Type = "Recirculation, Non-Demand Control"
															;						else	 4			; 10% of what we believe to be the correct value
															;						endif endif  }
	"Set cseDHWSYS:wsParElec_x"	cseDHWSYS:wsParElec_x	= {	UNDEFINED  }  ; if (Proj:IsMultiFamily > 0.5 .OR.
															;								(IfValidAnd( SourceDHWSys:Type = 5248 )==0 .AND. IfValidAnd( SourceDHWSys:Type = 8393856 )==0 .AND.
															;								 IfValidAnd( SourceDHWSys:Type = 5504 )==0 .AND. IfValidAnd( SourceDHWSys:Type = 8394112 )==0)) then  UNDEFINED
															;	else if (Proj:DHWCalcMthd == "CSE")		; straight CSE
															;	then	"hourval( 1.0, 0.5, 0.6, 0.6, 1.2, 2.4, 4.5, 5.7, 5.4, 4.5, 3.7, 2.8, 2.5, 2.3, 2.1, 1.9, 2.8, 3.2, 3.3, 3.1, 2.7, 2.5, 2.3, 1.5 )"
															;	else	; 10% of each schedule value above when in T24-match mode, since we believe T24 DLL electric pump results are only 10% of what they should be
															;			"hourval( 0.1, 0.05, 0.06, 0.06, 0.12, 0.24, 0.45, 0.57, 0.54, 0.45, 0.37, 0.28, 0.25, 0.23, 0.21, 0.19, 0.28, 0.32, 0.33, 0.31, 0.27, 0.25, 0.23, 0.15 )"
															;	endif endif  }		; scheduled use for SFam where Type = any demand-controlled recirculation

	; cseDHWHEATER & cseDHWTANK setup
;	"Create Child cseDHWHEATER - 1"		cseDHWSYS:ChildcseDHWHEATERs[1]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) < 1 .OR.
;																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																										else	CreateComp( cseDHWHEATER, "dhwhtr1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   endif  }
;	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:SourceDHWHeater"
;				cseDHWSYS:ChildcseDHWHEATERs[1]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "ResWtrHtr" ))
;																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
;;	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:SourceHVACSys"
;;				cseDHWSYS:ChildcseDHWHEATERs[1]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
;;																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
;	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[1]:whMult		= {	SourceDHWSys:HeaterMult[1]  }
;	; SAC 9/11/15 - revised logic to create cseDHWTANK objects for heaters of all types except large & small storage (as long as tank vol > 0)
;		"Create Child cseDHWTANK - 1"			cseDHWSYS:ChildcseDHWTANKs[1]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[1] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[1]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[1]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[1]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[1]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[1]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[1]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[1]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[1]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[1]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[1]:wtMult		= {	SourceDHWSys:HeaterMult[1]  }


	; Com cseDHWHEATER/cseDHWTANK for CENTRAL DHW systems
	"Create cseDHWHEATER children of Central ResDHWSys systems"
			ResWtrHtr:cseDHWHEATERRef	= {	if (IfValidAnd( ResDHWSys:SysFlrArea > 0.5 )==0 .OR. ResDHWSys:CentralSys < 0.5) then  UNCHANGED
														else	CreateComp( cseDHWHEATER, "dhwhtr-" + Name )  endif  }
	"Set ResWtrHtr:cseDHWHEATERRef Parent"					ResWtrHtr:cseDHWHEATERRef:Parent				= {	ParentRef( cseDHWSYSRef:Name )  }
	"Set ResWtrHtr:cseDHWHEATERRef:SourceDHWHeater"		ResWtrHtr:cseDHWHEATERRef:SourceDHWHeater	= {	Name  }
	"Create cseDHWTANK children of Central ResDHWSys systems"
			ResWtrHtr:cseDHWTANKRef		= {	if (IfValidAnd( ResDHWSys:SysFlrArea > 0.5 )==0 .OR. ResDHWSys:CentralSys < 0.5 .OR.
															 IfValidAnd( CSE_SimulateTank > 0.5 )==0) then  UNCHANGED
														else	CreateComp( cseDHWTANK, "dhwtnk-" + Name )  endif  }
	"Set ResWtrHtr:cseDHWTANKRef Parent"					ResWtrHtr:cseDHWTANKRef:Parent				= {	ParentRef( cseDHWSYSRef:Name )  }
	"Set ResWtrHtr:cseDHWTANKRef:SourceDHWHeater"		ResWtrHtr:cseDHWTANKRef:SourceDHWHeater	= {	Name  }

	; Com cseDHWHEATER/cseDHWTANK for NON-CENTRAL DHW systems
	"Create cseDHWHEATER children of Non-Central ResDHWSys systems"
			DwellUnitDHW:Action	= {	if (IfValidAnd( cseDHWSYSRef:SourceDHWSys:CentralSys < 0.5 )==0) then  UNCHANGED
												else	CreateDwellUnitDHWHeaters()  endif  }
				; CreateDwellUnitDHWHeaters( DwellUnitDHWName )
				;		loop over all cseDHWSYS objects and for each where cseDHWSYS:SourceDwellUnitDHW = DwellUnitDHWName...
				;			grab cseDHWSYS:SourceDHWSys
				;			loop over all ResWtrHtr children of cseDHWSYS:SourceDHWSys, creating a cseDHWHEATER for each, named "dhwhtr-<ResWtrHtr:Name> - <DwellUnitDHWName>"
				;			set:	cseDHWHEATER:Parent = cseDHWSYS
				;					cseDHWHEATER:SourceDHWHeater = ResWtrHtr:Name
	"Set cseDHWHEATER:whMult"		cseDHWHEATER:whMult		= {	SourceDHWHeater:Cnt  }
	"Set cseDHWTANK:wtMult"			cseDHWTANK:wtMult			= {	SourceDHWHeater:Cnt  }


;		"Create Child cseDHWHEATER - 2"		cseDHWSYS:ChildcseDHWHEATERs[2]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[2]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[2]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[2]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[2]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[2]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[2]:whMult		= {	SourceDHWSys:HeaterMult[2]  }
;	
;		"Create Child cseDHWTANK - 2"			cseDHWSYS:ChildcseDHWTANKs[2]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[2] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[2]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[2]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[2]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[2]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[2]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[2]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[2]:wtMult		= {	SourceDHWSys:HeaterMult[2]  }
;	
;		"Create Child cseDHWHEATER - 3"		cseDHWSYS:ChildcseDHWHEATERs[3]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[3]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[3]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[3]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[3]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[3]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[3]:whMult		= {	SourceDHWSys:HeaterMult[3]  }
;	
;		"Create Child cseDHWTANK - 3"			cseDHWSYS:ChildcseDHWTANKs[3]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[3] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[3]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[3]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[3]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[3]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[3]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[3]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[3]:wtMult		= {	SourceDHWSys:HeaterMult[3]  }
;	
;		"Create Child cseDHWHEATER - 4"		cseDHWSYS:ChildcseDHWHEATERs[4]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[4]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[4]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[4]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[4]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[4]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[4]:whMult		= {	SourceDHWSys:HeaterMult[4]  }
;	
;		"Create Child cseDHWTANK - 4"			cseDHWSYS:ChildcseDHWTANKs[4]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[4] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[4]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[4]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[4]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[4]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[4]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[4]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[4]:wtMult		= {	SourceDHWSys:HeaterMult[4]  }
;	
;		"Create Child cseDHWHEATER - 5"		cseDHWSYS:ChildcseDHWHEATERs[5]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[5]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[5]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[5]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[5]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[5]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[5]:whMult		= {	SourceDHWSys:HeaterMult[5]  }
;	
;		"Create Child cseDHWTANK - 5"			cseDHWSYS:ChildcseDHWTANKs[5]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[5] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[5]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[5]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[5]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[5]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[5]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[5]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[5]:wtMult		= {	SourceDHWSys:HeaterMult[5]  }
;	
;		"Create Child cseDHWHEATER - 6"		cseDHWSYS:ChildcseDHWHEATERs[6]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[6]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[6]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[6]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[6]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[6]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[6]:whMult		= {	SourceDHWSys:HeaterMult[6]  }
;	
;		"Create Child cseDHWTANK - 6"			cseDHWSYS:ChildcseDHWTANKs[6]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[6] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[6]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[6]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[6]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[6]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[6]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[6]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[6]:wtMult		= {	SourceDHWSys:HeaterMult[6]  }


	; SAC 10/21/15 - added DHWLOOP creation
	; SAC 11/10/15 - added check to ensure no loops for MFamDistType = No Loops/Pumps - was causing HUGE elec use in this scenario
	; SAC 8/3/16 - removed check for SourceDHWSys:MFamDistType > 0.5 in order to create a DHWLoop for central systems where MFamDistType = "Multi-family: No loops or recirc pump"
	"Create Child cseDHWLOOP"		cseDHWSYS:ChildcseDHWLOOP	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. IfValidAnd( SourceDHWSys:CentralSys > 0.5 )==0 .OR.
																							 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																						else	CreateComp( cseDHWLOOP, "dhwlp-" + LocalRef( SourceDHWSys:Name ) )   endif  }

	"Set cseDHWSYS:NumWaterHeaters"		cseDHWSYS:NumWaterHeaters	= {	SumChildren( cseDHWHEATER:whMult )  }		; SAC 7/18/15
;	"Set cseDHWHEATER:HrlyAdjRecovLoad - hourly adjusted recovery load (HARLj in ACM DHW docu)"		; SAC 7/17/15   
;					cseDHWHEATER:HrlyAdjRecovLoad	= {	if (cseDHWSYS:NumWaterHeaters < 1) then  0
;																	else	cseDHWSYS:HrlyAdjRecovLoad / cseDHWSYS:NumWaterHeaters  endif  }

  ; SAC 12/31/15 - revised logic of following rules to accommodate special handling of DHW heater & tank used to model HVACSys-based air-to-water heat pump DHW heating (tic 560)
  ; SAC 1/13/16 - similar revision as above comment for ResWtrHtr-source DHW when HeaterElementType = "Heat Pump" and IsHydronic flag set (should only happen in MFam) (tic 560)
	"Call subordinate rulelist to setup remaining cseDHWHEATER properties"
				cseDHWHEATER:Action	= {	     if (LocalCompAssigned( SourceDHWHeater ) > 0.5)
								;					then  if (IfValidAnd( SourceDHWHeater:HeaterElementType == 3 ) .AND. IfValidAnd( SourceDHWHeater:IsHydronic > 0.5 ))
								;							then	EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP",  1 )
															then	EvalRulelist( "CSE_SimulationPrep_DHWHtr_DHWHtr",  1 )
								;							endif
										;			else if (LocalCompAssigned( SourceHVACSys   ) > 0.5)
										;			then	if (IfValidAnd( SourceHVACSys:Type = 2 ) .AND. IfValidAnd( SourceHVACSys:HtPumpSysType = 11 ))
										;					then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP", 1 )
										;					else	EvalRulelist( "CSE_SimulationPrep_DHWHtr_HVACSys", 1 )  endif
													else  UNCHANGED  endif  }

  ; SAC 3/22/16 - set new property indicating whether or not a CSE pre-run is required for each cseDHWHEATER
  ;						based on e-mail from CSB: "PreRun is needed ONLY for SmallStorage, non-ASHPX.  (Supposedly) harmless for all other types"
	"Set cseDHWHEATER:CSEPreRunRequired"	cseDHWHEATER:CSEPreRunRequired	= {	if (IfValidAnd( whType == "SmallStorage" ) .AND.
																												 IfValidAnd( whHeatSrc != "ASHPX" )) then  1  else  0  endif  }
  ; SAC 3/22/16 - set cseDHWSYS:wsCalcMode based on whether or not any child heaters require pre-run
	"Set cseDHWSYS:wsCalcMode based on child cseDHWHEATER objects"		cseDHWSYS:wsCalcMode	= {	if (LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNDEFINED
																																else if (SumChildren( cseDHWHEATER:CSEPreRunRequired ) > 0.5)
																																then  "PreRun"  else  "Simulate"  endif endif  }

	"Set Proj:CSE_DHWPreRunReqd"	Proj:CSE_DHWPreRunReqd	= {	if (SumAll( cseDHWHEATER:CSEPreRunRequired ) > 0.5) then  1  else  0  endif  }		; SAC 3/22/16

	"Call subordinate rulelist to setup remaining cseDHWTANK properties"
				cseDHWTANK:Action		= {	     if (LocalCompAssigned( SourceDHWHeater ) > 0.5) then  EvalRulelist( "CSE_SimulationPrep_DHWTank_DHWHtr",  1 )
										;			else if (LocalCompAssigned( SourceHVACSys   ) > 0.5) then  EvalRulelist( "CSE_SimulationPrep_DHWTank_HVACSys", 1 )
												   else  UNCHANGED  endif  }

	"Call subordinate rulelist to setup remaining cseDHWLOOP properties"
				Proj:Action				= {	if (ComponentCount( cseDHWLOOP ) < 1) then  UNCHANGED
													else	EvalRulelist( "CSE_SimulationPrep_DHWLoop" )  endif  }		; default all via one call

; SAC 8/21/15 - REMOVED rule-based LDEF adjustment - this now happening inside CSE
;	"Call subordinate rulelist to revise whEF of cseDHWHEATER to a Load Dependent Energy Factor (LDEF) - ONLY for Small Storage water heaters"
;				cseDHWHEATER:Action	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc > 0 ) .AND. IfValidAnd( whEF > 0 ))
;													then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_LDEF",  1 )
;													else  UNCHANGED  endif  }
END

;*************************************************************************
RULELIST "Setup_cseDHWSYS_MetersAndTemperatures" 1 0 0 0
	"Set cseDHWSYS:wsElecMtr"			cseDHWSYS:wsElecMtr		= {	Proj:CSE_ElecMETER  }
	"Set cseDHWSYS:wsFuelMtr"			cseDHWSYS:wsFuelMtr		= {	     if (Proj:GasType == "NaturalGas") then  Proj:CSE_NatGasMETER
																						else if (Proj:GasType != "NaturalGas") then  Proj:CSE_OtherFuelMETER
																						else  UNDEFINED  endif endif  }

	"Set cseDHWSYS:wsFXHwMtr"			cseDHWSYS:wsFXHwMtr		= {	if (GlobalCompAssigned( Proj:CSE_FXHwDHWMETER ) < 1) then  UNDEFINED		; SAC 4/25/16
																						else	Proj:CSE_FXHwDHWMETER  endif  }
	"Set cseDHWSYS:wsWHHwMtr"			cseDHWSYS:wsWHHwMtr		= {	if (GlobalCompAssigned( Proj:CSE_WHHwDHWMETER ) < 1) then  UNDEFINED
																						else	Proj:CSE_WHHwDHWMETER  endif  }

	"Set cseDHWSYS:wsTUse"				cseDHWSYS:wsTUse			= {	if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
																						else	SourceDHWSys:HWSupplyTemp  endif  }
	; SAC 4/6/16 - added in conjunction w/ CSE 0.796 - related to new HPWH model
	"Set cseDHWSYS:wsTSetpoint"		cseDHWSYS:wsTSetpoint	= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED
																						else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
																						else	125  endif endif  }		; SAC 5/20/16 - removed MFam-Central dependence (e-mailed request from BAW)
																				;		else if (SourceDHWSys:CentralSys > 0.5)		; SAC 4/13/16 - revised to 130 for central systems
																				;		then  130  else  125  endif endif endif  }

	; Solar savings fraction inputs
	"Set cseDHWSYS:wsSSF"		cseDHWSYS:wsSSF		= {	if (SourceDHWSys:SolFracType != 1 .OR. IfValidAnd( SourceDHWSys:AnnualSolFrac >= 0 )==0) then  UNDEFINED  else  SourceDHWSys:AnnualSolFrac  endif  }
;	"Set cseDHWSYS:wsSSF_x"		cseDHWSYS:wsSSF_x		= {
;												if (SourceDHWSys:SolFracType != 2 .OR.
;														IfValidAnd( SourceDHWSys:SolFracMon[1]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[2]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[3]  >= 0 )==0 .OR.
;														IfValidAnd( SourceDHWSys:SolFracMon[4]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[5]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[6]  >= 0 )==0 .OR.
;														IfValidAnd( SourceDHWSys:SolFracMon[7]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[8]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[9]  >= 0 )==0 .OR.
;														IfValidAnd( SourceDHWSys:SolFracMon[10] >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[11] >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[12] >= 0 )==0 ) then  UNDEFINED
;												else	Format( "choose1( $month, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g )", SourceDHWSys:SolFracMon[1], SourceDHWSys:SolFracMon[2], SourceDHWSys:SolFracMon[3],
;																					SourceDHWSys:SolFracMon[4], SourceDHWSys:SolFracMon[5], SourceDHWSys:SolFracMon[6], SourceDHWSys:SolFracMon[7], SourceDHWSys:SolFracMon[8],
;																					SourceDHWSys:SolFracMon[9], SourceDHWSys:SolFracMon[10], SourceDHWSys:SolFracMon[11], SourceDHWSys:SolFracMon[12] )
;												endif  }
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_DHWHtr" 1 0 0 1
;*************************************************************************
	"Set cseDHWHEATER:whType"
			cseDHWHEATER:whType		= {	if (SourceDHWHeater:ElementTypeNum == 5) then  1		; "Heat Pump (2016)" -> "Small Storage"
													else	switch ( SourceDHWHeater:TankType )
																case  "Boiler"              :	4		; "Boiler"    -> "LargeInstantaneous"
																case  "Indirect"            :	4		; "Indirect"  -> "LargeInstantaneous"
																case  "Large Instantaneous" :	4	 	; "Large Instantaneous" 
																case  "Large Storage"       :	;if (Proj:DHWCalcMethod = 2 .AND. SourceDHWHeater:ElementTypeNum = 0)	; => "CSE (T24 match)" & Elec fuel
																										;then	1				; kludge to simulate Elec Large storage as Elec Small Storage when DHW mode is "CSE (T24 match)"
																										2		; "Large Storage"   
															;	case  4 :	PostError( "Unable to translate ResWtrHtr:TankType = 'Large Tankless' (4) to cseDHWHEATER:whType" ) 			; "Large Tankless" 
																case  "Small Instantaneous" :	3		; "Small Instantaneous" 
																case  "Small Storage"       :	1		; "Small Storage"     
															;	case  7 :	PostError( "Unable to translate ResWtrHtr:TankType = 'Unfired Storage Tank' (7) to cseDHWHEATER:whType" ) 	; "Unfired Storage Tank" 
															;	case  8 :	PostError( "Unable to translate ResWtrHtr:TankType = 'Electric Mini Tank' (8) to cseDHWHEATER:whType" ) 	; "Electric Mini Tank" 
																default :	PostError( "Unable to translate ResWtrHtr:TankType = 'unrecognized' (%g) to cseDHWHEATER:whType", SourceDHWHeater:TankType )
															endswitch  endif  }

	"Set cseDHWHEATER:whHeatSrc"
			cseDHWHEATER:whHeatSrc	= {	switch ( SourceDHWHeater:ElementTypeNum )
														case  0 :	if (IfValidAnd( SourceDHWHeater:TankZnDisp > 0.5 ))
																		then  5		; "Electric Resistance"  -> ResistanceX - switched from Res - SAC 4/14/16
																		else  2		; "Resistance"
																		endif
														case  1 :	1		; "Natural Gas"          -> Fuel
												;		case  2 :	1		; "Propane"              -> Fuel 
														case  3 :	3		; "Heat Pump"            -> ASHP
												;		case  4 :	1		; "Oil"                  -> Fuel
														case  5 :	4		; "Heat Pump (2016)"     -> ASHPX		; SAC 3/19/16
														default :	PostError( "Unable to translate ResWtrHtr:ElementTypeNum = 'unrecognized' (%g) to cseDHWHEATER:whHeatSrc", SourceDHWHeater:ElementTypeNum )
													endswitch  }
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
	"Set cseDHWHEATER:whFuelMtr"
			cseDHWHEATER:whFuelMtr	= {;	if (Proj:StandardsVersion > 2016 .OR. Proj:DRtgRefRunID == 2014)		; SAC 11/9/15  - SAC 4/7/16 - added in RESNET here (tic #631)
												;	then	switch ( SourceDHWHeater:ElementType )		; SAC 3/24/16 - revised logic to prevent specifying FuelMtr for Elec heaters
															switch ( SourceDHWHeater:ElementType )		; SAC 3/24/16 - revised logic to prevent specifying FuelMtr for Elec heaters
																case  "Electric Resistance" :	UNDEFINED		; "Electric Resistance"  
																case  "Heat Pump"           :	UNDEFINED		; "Heat Pump" 
												;				case  3 :	UNDEFINED		; "Heat Pump (2013)" 
												;				case  5 :	UNDEFINED		; "Heat Pump (2016)" 
																default :	if (     Proj:GasType == "NaturalGas" .AND. GlobalCompAssigned( Proj:CSE_NatGasMETER    )) then  Proj:CSE_NatGasMETER
																				else if (Proj:GasType != "NaturalGas" .AND. GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then  Proj:CSE_OtherFuelMETER
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - expected Proj:*METER not found.", Name )  endif endif
															endswitch  }
												;	else	switch ( SourceDHWHeater:ElementType )
												;				case  "Electric Resistance" :	UNDEFINED		; "Electric Resistance"   
												;				case  "Gas" :	if (GlobalCompAssigned( Proj:CSE_NatGasMETER )) then		Proj:CSE_NatGasMETER			; "Natural Gas" 
												;									else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - ResWtrHtr:ElementType = 'Natural Gas' (1) but Proj:CSE_NatGasMETER not defined.", Name )  endif
												;				case  2 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Propane"   
												;								else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - ResWtrHtr:ElementType = 'Propane' (2) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
												;				case  3 :	UNDEFINED		; "Heat Pump (2013)" 
												;				case  4 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Oil" 
												;								else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - ResWtrHtr:ElementType = 'Oil' (4) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
												;				case  5 :	UNDEFINED		; "Heat Pump (2016)" 
												;				default :	UNDEFINED
												;			endswitch  endif  }

	"Set cseDHWHEATER:whVol"			; SAC 9/10/15
			cseDHWHEATER:whVol	= {	if (IfValidAnd( SourceDHWHeater:TankVolume > 0 ) .AND. IfValidAnd( SourceDHWHeater:ElementTypeNum == 5 ) .AND.
													 IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEA < 0.5 )) then  SourceDHWHeater:TankVolume
												else if ((IfValidAnd( SourceDHWHeater:TankType = "Large Storage" )==0 .AND. IfValidAnd( SourceDHWHeater:TankType = "Small Storage" )==0) .OR.
															IfValidAnd( SourceDHWHeater:TankVolume >= 0 )==0 .OR. IfValidAnd( SourceDHWHeater:ElementTypeNum == 5 )) then  UNDEFINED
												else  SourceDHWHeater:TankVolume  endif endif  }

	"Set cseDHWHEATER:whEF"
			cseDHWHEATER:whEF		= {	if (IfValidAnd( SourceDHWHeater:EngyFac > 0 ) .AND. IfValidAnd( SourceDHWHeater:ElementTypeNum == 5 ) .AND.
													 IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEA < 0.5 )) then  SourceDHWHeater:EngyFac
												else if (IfValidAnd( SourceDHWHeater:ElementTypeNum == 5)==0 .AND. IfValidAnd( SourceDHWHeater:EngyFac > 0 ) .AND.
															(IfValidAnd( whType = "SmallStorage" ) .OR. IfValidAnd( whType = "SmallInstantaneous" )))		; SAC 8/21/15 - only for small instantaneous & storage
												then  SourceDHWHeater:EngyFac  else  UNDEFINED  endif endif  }
	"Set cseDHWHEATER:whEff"
			cseDHWHEATER:whEff	= {	if (SourceDHWHeater:ElementTypeNum != 5 .AND. IfValidAnd( SourceDHWHeater:ThrmlEff > 0 ) .AND.
													(IfValidAnd( whType = "LargeStorage" ) .OR. IfValidAnd( whType = "LargeInstantaneous" )))		; SAC 8/21/15 - only for boiler & large instantaneous & storage
												then  SourceDHWHeater:ThrmlEff  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whHPAF"
			cseDHWHEATER:whHPAF	= {	if (IfValidAnd( whType = "SmallStorage" ) .AND. IfValidAnd( whHeatSrc = "ASHP" ))		; SAC 8/21/15 - only for small storage, ASHP
												then  CAClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:CliZnNum )  else  UNDEFINED  endif  }
	; SAC 11/10/15 - added logic to transmit Pilot Energy in Btuh directly into whSBL input
	"Set cseDHWHEATER:whSBL"
			cseDHWHEATER:whSBL	= {	if (IfValidAnd( SourceDHWHeater:StdbyLossFrac > 0 ) .AND. IfValidAnd( SourceDHWHeater:StdbyLossFrac < 1 ) .AND.
													 IfValidAnd( SourceDHWHeater:TankVolume > 0 ) .AND. IfValidAnd( whType = "LargeStorage" ))		; SAC 8/21/15 - only for large storage		; SAC 9/8/15 - revised to be based on TankVolume
												then  SourceDHWHeater:StdbyLossFrac * 8.25 * SourceDHWHeater:TankVolume * 70
						; no whSBL modeled for any whType other than LargeStorage - this setting moved to whPilotPwr below
						;						else if (IfValidAnd( whType = 4 ) .AND. IfValidAnd( SourceDHWHeater:StdbyLossFrac > 0 ))
						;						then	SourceDHWHeater:StdbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
						;						else  UNDEFINED  endif endif  }
												else  UNDEFINED  endif  }
									;				 IfValidAnd( SourceDHWHeater:InputRating > 0 ) .AND. IfValidAnd( SourceDHWHeater:TankType = 3 ))		; SAC 8/21/15 - only for large storage
									;			then  SourceDHWHeater:InputRating * SourceDHWHeater:StdbyLossFrac  else  UNDEFINED  endif  }

	"Set cseDHWHEATER:whPilotPwr"
			cseDHWHEATER:whPilotPwr	= {	if (IfValidAnd( whType = "LargeInstantaneous" ) .AND. IfValidAnd( SourceDHWHeater:StdbyLossFrac > 0 ) .AND. IfValidAnd( whHeatSrc = "Fuel" ))
													then	SourceDHWHeater:StdbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
													else  UNDEFINED  endif  }

	; SAC 11/10/15 - added whParElec to model Elec Mini Tank elec use
	"Set cseDHWHEATER:whParElec"
			cseDHWHEATER:whParElec	= {	if (IfValidAnd( SourceDHWHeater:TankCat = "Instantaneous" ) .AND. IfValidAnd( SourceDHWHeater:ElecMiniTank > 0 ) .AND.
														 IfValidAnd( SourceDHWHeater:ElecMiniTankPwr > 0 ) .AND. IfValidAnd( SourceDHWHeater:HtPumpDisp = 0 ))
													then  SourceDHWHeater:ElecMiniTankPwr  else  UNDEFINED  endif  }

	"Set cseDHWHEATER:whElecMtr"		cseDHWHEATER:whElecMtr		= {	if (IfValidAnd( whParElec > 0 )) then  Proj:CSE_ElecMETER  else  UNCHANGED  endif  }

; SAC 3/19/16 - DHW input generation for new ASHP detailed model
	"Set cseDHWHEATER:whASHPType"		cseDHWHEATER:whASHPType		= {	if (SourceDHWHeater:ElementTypeNum != 5 .OR.
																								 (IfValidAnd( SourceDHWHeater:AirSrcHtPumpType != "- select HPWH type -" )==0 .AND.
																								  IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEA > 0.5 ))) then  UNDEFINED
																							else if (IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEA > 0.5 )==0) then  "Generic"
																							else	switch ( SourceDHWHeater:AirSrcHtPumpType )
																										case  "AO Smith PHPT 60" : "AOSmithPHPT60"		; "AO Smith PHPT 60"
																										case  "AO Smith PHPT 80" : "AOSmithPHPT80"		; "AO Smith PHPT 80"
																										case  "AO Smith HPTU 50" : "AOSmithHPTU50"		; "AO Smith HPTU 50"
																										case  "AO Smith HPTU 66" : "AOSmithHPTU66"		; "AO Smith HPTU 66"
																										case  "AO Smith HPTU 80" : "AOSmithHPTU80"		; "AO Smith HPTU 80"
																										case  "GE2014 50"        : "GE2014StdMode"		; "GE2014 50"
																										case  "GE2014 80"        : "GE2014StdMode80"	; "GE2014 80"
																										case  "Rheem HB 50"      : "RheemHB50"			; "Rheem HB 50"
																										case  "Stiebel 220E"     : "Stiebel220E"			; "Stiebel 220E"
																										default :	if (IfValidAnd( Proj:DebugScreen > 0.5 ))
																														then	switch ( SourceDHWHeater:AirSrcHtPumpType )
																																	case  "Sanden 40"        : "Sanden40"				; "Sanden 40"
																																	case  "Sanden 80"        : "Sanden80"				; "Sanden 80"
																																	case  "Worst Case Medium":	"WorstCaseMedium"		; "Worst Case Medium"
																																	default:  UNDEFINED
																																endswitch
																														else  UNDEFINED  endif
																									endswitch  endif endif  }

	"Set cseDHWHEATER:whResHtPwr"		cseDHWHEATER:whResHtPwr		= {	if (SourceDHWHeater:ElementTypeNum != 0 .OR. IfValidAnd( SourceDHWHeater:TankZnDisp > 0 )==0 .OR.
																								 IfValidAnd( SourceDHWHeater:InpRatingElec > 0 )==0) then  UNDEFINED
																							else	SourceDHWHeater:InpRatingElec  endif  }

;	"Set cseDHWHEATER:whZone"			cseDHWHEATER:whZone			= {	if (SourceDHWHeater:TankZnDisp < 1 .OR.
;																								 IfValidAnd( SourceDHWHeater:TankZn = "Outside or in Exterior Closet" ) .OR.
;																								 LocalCompAssigned( SourceDHWHeater:TankZone ) < 1) then  UNDEFINED
;																							else if (LocalCompAssigned( SourceDHWHeater:TankZone:CSE_ZONE ) < 1) then  UNDEFINED
;																							else	SourceDHWHeater:TankZone:CSE_ZONE  endif endif  }
	"Set cseDHWHEATER:whTEx_x"			cseDHWHEATER:whTEx_x			= {	if (IfValidAnd( SourceDHWHeater:TankZnDisp > 0 )==0 .OR.
																									LocalStatus( SourceDHWHeater:TankZn ) < 1) then  UNDEFINED
																						;		 LocalCompAssigned( whZone ) > 0) then  UNDEFINED
																							else	switch ( SourceDHWHeater:TankZn )
																										case "Conditioned"                   :  "70" 
																										case "Unconditioned"                 :  "($tDbO + 70) / 2"
																										case "Outside or in Exterior Closet" :  "$tDbO"
																										default :  UNDEFINED
																									endswitch  endif  }
;	"Set cseDHWHEATER:whASHPSrcZn"	cseDHWHEATER:whASHPSrcZn	= {	if (SourceDHWHeater:ElementTypeNum != 5 .OR.
;																								 (IfValidAnd( SourceDHWHeater:AirSrcHtPumpType != "- select HPWH type -" )==0 .AND. SourceDHWHeater:HtPumpWtrHtrNEEA > 0.5) .OR.
;																								 IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .OR.
;																								 IfValidAnd( SourceDHWHeater:ASHPTSrcOutside > 0 ) .OR.
;																								 LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) < 1) then  UNDEFINED
;																							else if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone:CSE_ZONE ) < 1) then  UNDEFINED
;																							else	SourceDHWHeater:ASHPTSrcZone:CSE_ZONE  endif endif  }
	"Set cseDHWHEATER:whASHPSrcT_x"	cseDHWHEATER:whASHPSrcT_x	= {	if (SourceDHWHeater:ElementTypeNum != 5 .OR.
																								 (IfValidAnd( SourceDHWHeater:AirSrcHtPumpType != "- select HPWH type -" )==0 .AND.
																								  IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEA > 0.5 )))
																							then	UNDEFINED
																							else if (IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEA > 0.5 ) .AND.
																										(IfValidAnd( SourceDHWHeater:AirSrcHtPumpType = "Sanden 40" ) .OR.
																										 IfValidAnd( SourceDHWHeater:AirSrcHtPumpType = "Sanden 80" )))
																							then 	switch ( SourceDHWHeater:TankZn )
																										case "Conditioned"                   :  "70" 
																										case "Unconditioned"                 :  "($tDbO + 70) / 2"
																										case "Outside or in Exterior Closet" :  "$tDbO"
																										default :  UNDEFINED
																									endswitch
																							else  UNDEFINED  endif endif  }
																					;			 IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .OR.
																					;			 LocalCompAssigned( whASHPSrcZn ) > 0) then  UNDEFINED
																					;		else	"$tDbO"  endif  }
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWTank_DHWHtr" 1 0 0 1
;*************************************************************************
;	"Set cseDHWTANK:SurfaceArea"
;			cseDHWTANK:SurfaceArea	= {	    DHWTankAreaCoefs:CoefE( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) *
;													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) * pow( SourceDHWHeater:TankVolume, 0.33 ) ) + 
;													    DHWTankAreaCoefs:CoefG( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) ) *
;													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) * pow( SourceDHWHeater:TankVolume, 0.33 ) ) + 
;													    DHWTankAreaCoefs:CoefG( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) )  }
;	"Set cseDHWTANK:wtUA"
;			cseDHWTANK:wtUA			= {	if (IfValidAnd( SourceDHWHeater:ExtInsulRVal > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:IntInsulRVal > 0 )==0) then  UNDEFINED
;													else	SurfaceArea / (ValidOr( SourceDHWHeater:ExtInsulRVal, 0 ) + ValidOr( SourceDHWHeater:IntInsulRVal, 0 ))
;													endif  }
; SAC 9/10/15 - replace specification of wtUA (above) with wtVol & wtInsulR
	"Set cseDHWTANK:wtVol"			cseDHWTANK:wtVol			= {	if (IfValidAnd( SourceDHWHeater:TankVol >= 0 ))
																					then  SourceDHWHeater:TankVol
																					else	UNDEFINED  endif  }
	; SAC 9/11/15 - define minimum wtInsulR as 12
	"Set cseDHWTANK:wtInsulR"		cseDHWTANK:wtInsulR		= {	if (ValidOr( SourceDHWHeater:TankExtInsR, 0 ) + ValidOr( SourceDHWHeater:TankIntInsR, 0 ) > 12)
																					then	ValidOr( SourceDHWHeater:TankExtInsR, 0 ) + ValidOr( SourceDHWHeater:TankIntInsR, 0 )
																					else	12  endif  }
	; SAC 9/11/15 - added rules for wtTEx, wtTTank & wtXLoss
	"Set cseDHWTANK:wtTEx"  		cseDHWTANK:wtTEx  		= {	if (IfValidAnd( SourceDHWHeater:AmbCond = "Conditioned"   )) then    75     else  UNDEFINED  endif  }		; if Conditioned
	"Set cseDHWTANK:wtTEx_x"		cseDHWTANK:wtTEx_x		= {	if (IfValidAnd( SourceDHWHeater:AmbCond = "Unconditioned" )) then  "$tDbO"  else  UNDEFINED  endif  }		; if Unconditioned
	"Set cseDHWTANK:wtTTank"		cseDHWTANK:wtTTank		= {	Parent( wsTUse )  }
	"Set cseDHWTANK:wtXLoss"		cseDHWTANK:wtXLoss		= {	61.4  }
END


;;*************************************************************************
;RULELIST "CSE_SimulationPrep_DHWHtr_HVACSys" 1 0 0 1
;;*************************************************************************
;	"Set cseDHWHEATER:whType"
;			cseDHWHEATER:whType		= {	switch ( SourceHVACSys:DHWTankType )
;														case  0 :	4		; "Boiler"    -> "LargeInstantaneous"
;														case  1 :	4		; "Indirect"  -> "LargeInstantaneous"
;														case  2 :	4	 	; "Large Instantaneous" 
;														case  3 :	;if (Proj:DHWCalcMethod = 2 .AND. SourceHVACSys:DHWHeaterElementType = 0)	; => "CSE (T24 match)" & Elec fuel
;																		;then	1				; kludge to simulate Elec Large storage as Elec Small Storage when DHW mode is "CSE (T24 match)"
;																		2		; "Large Storage"   
;													;	case  4 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Large Tankless' (4) to cseDHWHEATER:whType" ) 		; "Large Tankless" 
;														case  5 :	3		; "Small Instantaneous" 
;														case  6 :	1		; "Small Storage"     
;													;	case  7 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Unfired Storage Tank' (7) to cseDHWHEATER:whType" ) ; "Unfired Storage Tank" 
;														case  8 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Electric Mini Tank' (8) to cseDHWHEATER:whType" ) 	; "Electric Mini Tank" 
;														default :	PostError( "Unable to translate HVACSys:DHWTankType = 'unrecognized' (%g) to cseDHWHEATER:whType", SourceHVACSys:DHWTankType )
;													endswitch  }
;	"Set cseDHWHEATER:whHeatSrc"
;			cseDHWHEATER:whHeatSrc	= {	switch ( SourceHVACSys:DHWHeaterElementType )
;														case  0 :	2		; "Electric Resistance"   
;														case  1 :	1		; "Natural Gas"   -> Fuel
;														case  2 :	1		; "Propane"       -> Fuel 
;														case  3 :	3		; "Heat Pump"     -> ASHP
;														case  4 :	1		; "Oil"           -> Fuel
;														default :	PostError( "Unable to translate SourceHVACSys:DHWHeaterElementType = 'unrecognized' (%g) to cseDHWHEATER:whHeatSrc", SourceHVACSys:DHWHeaterElementType )
;													endswitch  }
;;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
;	"Set cseDHWHEATER:whFuelMtr"
;			cseDHWHEATER:whFuelMtr	= {	switch ( SourceHVACSys:DHWHeaterElementType )
;														case  0 :	UNDEFINED		; "Electric Resistance"   
;														case  1 :	if (GlobalCompAssigned( Proj:CSE_NatGasMETER )) then		Proj:CSE_NatGasMETER			; "Natural Gas" 
;																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Natural Gas' (1) but Proj:CSE_NatGasMETER not defined.", Name )  endif
;														case  2 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Propane"   
;																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Propane' (2) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
;														case  3 :	UNDEFINED		; "Heat Pump" 
;														case  4 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Oil" 
;																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Oil' (4) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
;														default :	UNDEFINED
;													endswitch  }
;
;	"Set cseDHWHEATER:whVol"			; SAC 9/10/15
;			cseDHWHEATER:whVol	= {	if ((IfValidAnd( SourceHVACSys:DHWTankType = 3 )==0 .AND. IfValidAnd( SourceHVACSys:DHWTankType = 6 )==0) .OR. IfValidAnd( SourceHVACSys:DHWTankVolume >= 0 )==0) then  UNDEFINED
;												else  SourceHVACSys:DHWTankVolume  endif  }
;
;	"Set cseDHWHEATER:whEF"
;			cseDHWHEATER:whEF		= {	if (IfValidAnd( SourceHVACSys:DHWEnergyFactor > 0 ) .AND.
;													(IfValidAnd( whType = 1 ) .OR. IfValidAnd( whType = 3 )))		; SAC 8/21/15 - only for small instantaneous & storage
;												then  SourceHVACSys:DHWEnergyFactor  else  UNDEFINED  endif  }
;	"Set cseDHWHEATER:whEff"
;			cseDHWHEATER:whEff	= {	if (IfValidAnd( SourceHVACSys:DHWEnergyFactor > 0 ) .AND.
;													(IfValidAnd( whType = 2 ) .OR. IfValidAnd( whType = 4 )))		; SAC 8/21/15 - only for large instantaneous & storage
;												then  SourceHVACSys:DHWEnergyFactor  else  UNDEFINED  endif  }
;	"Set cseDHWHEATER:whHPAF"
;			cseDHWHEATER:whHPAF	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc = 3 ))		; SAC 8/21/15 - only for small storage, ASHP
;												then  CAClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:CliZnNum )  else  UNDEFINED  endif  }
;	"Set cseDHWHEATER:whSBL"
;			cseDHWHEATER:whSBL	= {	if (IfValidAnd( SourceHVACSys:DHWStandbyLossFrac > 0 ) .AND. IfValidAnd( SourceHVACSys:DHWStandbyLossFrac < 1 ) .AND.
;													 IfValidAnd( SourceHVACSys:DHWTankVolume > 0 ) .AND. IfValidAnd( whType = 2 ))		; SAC 8/21/15 - only for large storage		; SAC 9/8/15 - revised to be based on TankVolume
;												then  SourceHVACSys:DHWStandbyLossFrac * 8.25 * SourceHVACSys:DHWTankVolume * 70  else  UNDEFINED  endif  }
;									;				 IfValidAnd( SourceHVACSys:DHWInputRating > 0 ) .AND. IfValidAnd( SourceHVACSys:DHWTankType = 3 ))		; SAC 8/21/15 - only for large storage
;									;			then  SourceHVACSys:DHWInputRating * SourceHVACSys:DHWStandbyLossFrac  else  UNDEFINED  endif  }
;END
;
;;*************************************************************************
;RULELIST "CSE_SimulationPrep_DHWTank_HVACSys" 1 0 0 1
;;*************************************************************************
;	"Set cseDHWTANK:SurfaceArea"
;			cseDHWTANK:SurfaceArea	= {	    DHWTankAreaCoefs:CoefE( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) *
;													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) * pow( SourceHVACSys:DHWTankVolume, 0.33 ) ) + 
;													    DHWTankAreaCoefs:CoefG( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) ) *
;													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) * pow( SourceHVACSys:DHWTankVolume, 0.33 ) ) + 
;													    DHWTankAreaCoefs:CoefG( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) )  }
;;	"Set cseDHWTANK:wtUA"
;;			cseDHWTANK:wtUA			= {	if (IfValidAnd( SourceHVACSys:DHWExtInsulRVal > 0 )==0 .AND. IfValidAnd( SourceHVACSys:DHWIntInsulRVal > 0 )==0) then  UNDEFINED
;;													else	SurfaceArea / (ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 ))
;;													endif  }
;; SAC 9/10/15 - replace specification of wtUA (above) with wtVol & wtInsulR
;	"Set cseDHWTANK:wtVol"			cseDHWTANK:wtVol			= {	if (IfValidAnd( SourceHVACSys:DHWTankVolume >= 0 ))
;																					then  SourceHVACSys:DHWTankVolume
;																					else	UNDEFINED  endif  }
;	; SAC 9/11/15 - define minimum wtInsulR as 12
;	"Set cseDHWTANK:wtInsulR"		cseDHWTANK:wtInsulR		= {	if (ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 ) > 12)
;																					then	ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 )
;																					else	12  endif  }
;	; SAC 9/11/15 - added rules for wtTEx, wtTTank & wtXLoss
;	"Set cseDHWTANK:wtTEx"  		cseDHWTANK:wtTEx  		= {	if (IfValidAnd( SourceHVACSys:DHWAmbientCond = -1 )) then    75     else  UNDEFINED  endif  }		; if Conditioned
;	"Set cseDHWTANK:wtTEx_x"		cseDHWTANK:wtTEx_x		= {	if (IfValidAnd( SourceHVACSys:DHWAmbientCond =  1 )) then  "$tDbO"  else  UNDEFINED  endif  }		; if Unconditioned
;	"Set cseDHWTANK:wtTTank"		cseDHWTANK:wtTTank		= {	Parent( wsTUse )  }
;	"Set cseDHWTANK:wtXLoss"		cseDHWTANK:wtXLoss		= {	61.4  }
;END

; SAC 12/31/15 - DHW input generation kludge to setup CSE DHW inputs for HVACSys-based AirToWater heat pumps
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_AWHP" 1 0 0 1
;*************************************************************************
	"Set cseDHWHEATER:whType"			cseDHWHEATER:whType		= {	"SmallStorage"	}		; "Small Storage"     
	"Set cseDHWHEATER:whHeatSrc"		cseDHWHEATER:whHeatSrc	= {	"ASHP"	}		; ASHP
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
;	"Set cseDHWHEATER:whFuelMtr"		cseDHWHEATER:whFuelMtr	= {	
;	"Set cseDHWHEATER:whVol"			cseDHWHEATER:whVol		= {	
;	"Set cseDHWHEATER:whEF"				cseDHWHEATER:whEF			= {	
;	"Set cseDHWHEATER:whEff"			cseDHWHEATER:whEff		= {	
	"Set cseDHWHEATER:whHPAF"			cseDHWHEATER:whHPAF		= {	1  }
;	"Set cseDHWHEATER:whSBL"			cseDHWHEATER:whSBL		= {	
	"Set cseDHWHEATER:whLDEF"			cseDHWHEATER:whLDEF		= {	3.4  }
END

; SAC 10/21/15 - added DHWLOOP
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoop" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOP for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
   "Set cseDHWLOOP:wlMult"     cseDHWLOOP:wlMult    = {
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  1
         else if (IfValidAnd( SourceDHWSys:LpCnt >= 1 ) .AND.
                  IfValidAnd( SourceDHWSys:CentralSys = 1 ))
         then  SourceDHWSys:LpCnt
         else  UNDEFINED  endif endif  }
   "Set cseDHWLOOP:wlFlow"     cseDHWLOOP:wlFlow    = {
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  0
         else  6  endif  }
   "Set cseDHWLOOP:wlFUA"      cseDHWLOOP:wlFUA     = {  2.0  }

   ; based on Res ACm table B-3
   "Set cseDHWLOOP:wlTIn1"     cseDHWLOOP:wlTIn1    = {
         if (ParentStatus( SourceDHWSys:DistType ) < 1) then  UNDEFINED
         else  switch ( SourceDHWSys:DistType )
                     case "No loops or central system pump"                       :  130      ; "Multi-family: No loops or recirc pump"
                     case "No Control (continuous pumping)"                       :  130      ; "No Control"
                     case "Demand Control (Standard Design for new construction)" :  130      ; "Multi-family: Recirculation demand control"
         ;            case 8393664 :  130      ; "No Control with HERS verification"
         ;            case 8394944 :  130      ; "Demand Control with HERS verification"
                     default      :  UNDEFINED      ; others set via expression below
               endswitch  endif  }
   "Set cseDHWLOOP:wlTIn1_x"   cseDHWLOOP:wlTIn1_x  = {
         if (ParentStatus( SourceDHWSys:DistType ) < 1) then  UNDEFINED
         else if (SourceDHWSys:DistType == "Temperature modulation" )  ; ||   ; "Temperature modulation"
      ;            SourceDHWSys:DistType == 8395200 )    ; "Temperature modulation with HERS verification"
         then  "hourval( 120, 120, 120, 120, 120, 125, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 125)"
         else if (SourceDHWSys:DistType == "Temperature modulation and monitoring" )  ; ||   ; "Temperature modulation & monitoring"
      ;            SourceDHWSys:DistType == 8395456 )    ; "Temperature modulation & monitoring with HERS verification"
         then  "hourval( 115, 115, 115, 115, 115, 120, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 120)"
         else  UNDEFINED  endif endif endif  }

   ; based on Res ACM table B-3
   "Set cseDHWLOOP:wlRunF"     cseDHWLOOP:wlRunF    = {
         if (ParentStatus( SourceDHWSys:DistType ) < 1) then  UNDEFINED
         else  switch ( SourceDHWSys:DistType )
                  case "Demand Control (Standard Design for new construction)" :  0.2      ; "Multi-family: Recirculation demand control"
            ;      case 8394944 :  0.2      ; "Demand Control with HERS verification"
                  default      :  1.0      ; all others
               endswitch  endif  }

   ; SAC 10/28/15 - added DHWLOOPPUMP creation
   "Create Child cseDHWLOOPPUMP"          cseDHWLOOP:ChildcseDHWLOOPPUMP            = {
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" ) .OR.
             IfValidAnd( SourceDHWSys:PumpBHP > 0 )==0 .OR.
             IfValidAnd( SourceDHWSys:PumpEff > 0 )==0) then  UNCHANGED
         else   CreateComp( cseDHWLOOPPUMP, "dhwlppmp-" + ParentRef( SourceDHWSys:Name ) )  endif  }
   "Set ChildcseDHWLOOPPUMP:wlpMult"      cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpMult    = {
         UNDEFINED  }
   "Set ChildcseDHWLOOPPUMP:wlpPwr"       cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpPwr     = {
         746 * SourceDHWSys:PumpBHP / SourceDHWSys:PumpEff  }
   "Set ChildcseDHWLOOPPUMP:wlpElecMtr"   cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpElecMtr = {
         Proj:CSE_ElecMETER  }

   ; SAC 10/22/15 - added DHWLOOPSEG creation
   "Create Child cseDHWLOOPSEG-1"               cseDHWLOOP:ChildcseDHWLOOPSEGs[1]      = {   
         CreateComp( cseDHWLOOPSEG, "dhwlpseg1-" + ParentRef( SourceDHWSys:Name ) )  }
   "Set ChildcseDHWLOOPSEGs[1]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[1]:SegmentIndex  = {  1  }
   "Create Child cseDHWLOOPSEG-2"               cseDHWLOOP:ChildcseDHWLOOPSEGs[2]      = {   
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg2-" + ParentRef( SourceDHWSys:Name ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[2]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[2]:SegmentIndex  = {  2  }
   "Create Child cseDHWLOOPSEG-3"               cseDHWLOOP:ChildcseDHWLOOPSEGs[3]      = {   
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg3-" + ParentRef( SourceDHWSys:Name ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[3]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[3]:SegmentIndex  = {  3  }
   "Create Child cseDHWLOOPSEG-4"               cseDHWLOOP:ChildcseDHWLOOPSEGs[4]      = {   
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg4-" + ParentRef( SourceDHWSys:Name ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[4]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[4]:SegmentIndex  = {  4  }
   "Create Child cseDHWLOOPSEG-5"               cseDHWLOOP:ChildcseDHWLOOPSEGs[5]      = {   
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg5-" + ParentRef( SourceDHWSys:Name ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[5]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[5]:SegmentIndex  = {  5  }
   "Create Child cseDHWLOOPSEG-6"               cseDHWLOOP:ChildcseDHWLOOPSEGs[6]      = {   
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg6-" + ParentRef( SourceDHWSys:Name ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[6]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[6]:SegmentIndex  = {  6  }

   ; cseDHWLOOPSEG defaulting done all at once, not called for each individual 
   "Call subordinate rulelist to setup remaining cseDHWLOOPSEG properties"
            Proj:Action      = {   EvalRulelist( "CSE_SimulationPrep_DHWLoopSeg" )  }
END

; SAC 10/22/15 - added DHWLOOPSEG
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoopSeg" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOPSEG for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
   ; SegmentIndex must already set
   "Set cseDHWLOOPSEG:wgTy"
      cseDHWLOOPSEG:wgTy = {
         if (IfValidAnd( SegmentIndex > 3 ))
         then   2      ; demand
         else   1      ; supply
         endif  }
   ; based on Res ACM method WH-LOOPSZ
   "Set cseDHWLOOPSEG:NUnitThisSeg"
      cseDHWLOOPSEG:NUnitThisSeg = {
         if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0 .OR. IfValidAnd( wlMult > 0 )==0)
         then  -1  ; ERROR
         else if (IfValidAnd( SegmentIndex < 4 )==0)
         then  0      ; no NUnit... for segments 4-6
         else if (IfValidAnd( SegmentIndex < 3 ))
         then   SourceDHWSys:NumDUsServed / wlMult
         else   SourceDHWSys:NumDUsServed / wlMult / 2
         endif endif endif  }
   "Set cseDHWLOOPSEG:wgSize"
      cseDHWLOOPSEG:wgSize = {
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  2.0
         else if (IfValidAnd( SegmentIndex > 3 ))
         then   ; RETURN pipe segments
               if (IfValidAnd( SourceDHWSys:SysStoryCnt > 4 ))
               then   1.0
               else   0.75
               endif
         else   ; SUPPLY pipe segments
               if (IfValidAnd( NUnitThisSeg > 0 ))
               then   CAResDHW_LoopPipeSize:PipeDiam( "CodeBase", Proj:StdsYr,
                                                      "NUnit", NUnitThisSeg, "IsBranch", "No" )
               else   UNDEFINED      ; error
               endif
         endif endif  }
   ; based on Res ACM method WH-LOOPLEN
; SAC 8/16/16 - no need for addiitonal Res rules to calculate # flrs served and avg flr height, since # flrs a user input and avg flr ht already calculated (minus plenums)
   "Set cseDHWLOOPSEG:AvgDULen"
      cseDHWLOOPSEG:AvgDULen = {
         if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0) then  0      ; error
         else   sqrt( ValidOr( SourceDHWSys:SysFlrArea, 0 ) / SourceDHWSys:NumDUsServed )
         endif  }
   "Set cseDHWLOOPSEG:wgLength"
      cseDHWLOOPSEG:wgLength = {
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  0
         else if (IfValidAnd( SegmentIndex = 1 ) .OR. IfValidAnd( SegmentIndex = 6 ))
         then      8 + ( SourceDHWSys:AvgFlrHgt * ValidOr( SourceDHWSys:SysStoryCnt, 1 ) / 2 )
         else   ; segment index not 1 or 6
               if (  IfValidAnd( SourceDHWSys:NumDUsServed >  0 )==0 .OR. 
                     IfValidAnd( SourceDHWSys:LpCnt        >= 1 )==0 .OR.
                     IfValidAnd( SourceDHWSys:SysStoryCnt  >  0 )==0 ) then  UNDEFINED      ; error
               else   AvgDULen * SourceDHWSys:NumDUsServed /
                     (4 * SourceDHWSys:LpCnt * SourceDHWSys:SysStoryCnt)
               endif
         endif endif  }
   "Set cseDHWLOOPSEG:wgInsulThk"
      cseDHWLOOPSEG:wgInsulThk    = {   SourceDHWSys:LpPipeInsThkns  }
   "Set cseDHWLOOPSEG:wgInsulK"
      cseDHWLOOPSEG:wgInsulK      = {   0.02167  }
   "Set cseDHWLOOPSEG:wgFNoDraw"
      cseDHWLOOPSEG:wgFNoDraw     = {   if (IfValidAnd( SegmentIndex > 0 )==0) then  UNDEFINED
                                        else   switch ( SegmentIndex )
                                                 case  1 :  0.2
                                                 case  2 :  0.4
                                                 case  3 :  0.6
                                                 default :  1.0
                                              endswitch  endif  }
   "Set cseDHWLOOPSEG:wgExT"
      cseDHWLOOPSEG:wgExT    = {;   if (IfValidAnd( SourceDHWSys:RecircPipeLoc[1] >= 0 )==0) then  UNDEFINED
                                ;   else  switch ( SourceDHWSys:RecircPipeLoc[1] )
                                         switch ( SourceDHWSys:PipeLctn[1] )  
                                            case  "Conditioned"      :  70		; Conditioned
                                            case  "Semi-Conditioned" :  70		; Semi-Conditioned
                                            default :  UNDEFINED
                                         endswitch  }
   "Set cseDHWLOOPSEG:wgExT_x"
      cseDHWLOOPSEG:wgExT_x  = {;   if (IfValidAnd( SourceDHWSys:RecircPipeLoc[1] >= 0 )==0) then  UNDEFINED
                                ;   else   switch ( SourceDHWSys:RecircPipeLoc[1] )
                                         switch ( SourceDHWSys:PipeLctn[1] )
                                            case  "Unconditioned" :  "$TdbO"            ; Unconditioned (outdoor)
                                            case  "Underground"   :  "@Weather.tgrnd"   ; Underground (ground)
                                            default :  UNDEFINED
                                         endswitch  }
   "Set cseDHWLOOPSEG:wgExH"
      cseDHWLOOPSEG:wgExH    = {   1.5  }

   ; SAC 10/22/15 - added DHWLOOPSEG creation
   ; SAC 8/1/16 - modified to create branches for loop segs #2 & 3 (rather than only #1)
   "Create Child cseDHWLOOPBRANCH"
      cseDHWLOOPSEG:ChildcseDHWLOOPBRANCH = {
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" ) .AND. IfValidAnd( SegmentIndex = 1 ))
         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr1-" + Parent2Ref( SourceDHWSys:Name ) )
         else if (IfValidAnd( SegmentIndex = 2 ))
         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr2-" + Parent2Ref( SourceDHWSys:Name ) )
         else if (IfValidAnd( SegmentIndex = 3 ))
         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr3-" + Parent2Ref( SourceDHWSys:Name ) )
         else  UNDEFINED  endif endif endif  }
   "Call subordinate rulelist to setup remaining cseDHWLOOPBRANCH properties (all at once, not by branch)"
      Proj:Action = {   EvalRulelist( "CSE_SimulationPrep_DHWLoopBranch" )  }
END

; SAC 10/22/15 - added DHWLOOPBRANCH
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoopBranch" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOPBRANCH for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
   ; based on Res ACM method WH-BRNU
   "Set cseDHWLOOPBRANCH:NUnitThisBranch"   
      cseDHWLOOPBRANCH:NUnitThisBranch = {
         if (IfValidAnd( SourceDHWSys:SysStoryCnt > 0 )==0) then  -1  ; ERROR
         else  max( (SourceDHWSys:SysStoryCnt / 2), 1 )  endif  }
   ; based on Res ACM method WH-BRN
   ; SAC 8/1/16 - revised expression based on loop segment branch fixes - replaced NUnitThisBranch in denominator w/ ()
   "Set cseDHWLOOPBRANCH:wbMult"
      cseDHWLOOPBRANCH:wbMult = {
         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" ) .AND. NUnitThisBranch > 0 .AND.
             IfValidAnd( SourceDHWSys:NumDUsServed > 0 ))
         then  SourceDHWSys:NumDUsServed /  NUnitThisBranch
         else if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0 .OR. NUnitThisBranch <= 0 .OR.
             IfValidAnd( SourceDHWSys:LpCnt > 0 )==0) then  UNDEFINED
         else  SourceDHWSys:NumDUsServed / (NUnitThisBranch * SourceDHWSys:LpCnt * 2)  endif endif  }

   ; based on Res ACM method WH-BRSZ
   "Set cseDHWLOOPBRANCH:wbSize"
      cseDHWLOOPBRANCH:wbSize = {
         if (IfValidAnd( NUnitThisBranch > 0 ))
         then   CAResDHW_LoopPipeSize:PipeDiam( "CodeBase", Proj:StdsYr,
                                                "NUnit", NUnitThisBranch, "IsBranch", "Yes" )
         else   UNDEFINED      ; error
         endif  }
   ; based on Res ACM method WH-BRLEN
   "Set cseDHWLOOPBRANCH:wbLength"
      cseDHWLOOPBRANCH:wbLength = {
         4 + ( SourceDHWSys:AvgFlrHgt * ValidOr( SourceDHWSys:SysStoryCnt, 1 ) / 2 )  }

   "Set cseDHWLOOPBRANCH:wbFlow"       cseDHWLOOPBRANCH:wbFlow       = {   2        }
   "Set cseDHWLOOPBRANCH:wbInsulThk"   cseDHWLOOPBRANCH:wbInsulThk   = {   SourceDHWSys:LpPipeInsThkns  }
   "Set cseDHWLOOPBRANCH:wbInsulK"     cseDHWLOOPBRANCH:wbInsulK     = {   0.02167  }
   "Set cseDHWLOOPBRANCH:wbExH"        cseDHWLOOPBRANCH:wbExH        = {   1.5      }
   "Set cseDHWLOOPBRANCH:wbExT"        cseDHWLOOPBRANCH:wbExT        = {   70       }

   ;   wbFWaste is based on Res ACM method WH-BRWF
   ;      wbFWaste = Nwaste * SCHwaste * fVol
   ;      NWaste = 19.84 * exp( -0.544 * Nunit,b)               Nunit,b = Nfloor/2
   ;      SCHwaste per Table B-4
   ;      fVol = 1.4
   ;      So 
   "Set cseDHWLOOPBRANCH:wbFWaste_x"   cseDHWLOOPBRANCH:wbFWaste_x  = {   
      Format( "1.4 * 19.84 * exp( -0.544 * %g ) * hourval( 0.01, 0.02, 0.05, 0.22, 0.25, 0.22, 0.06, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01)", NUnitThisBranch )  }

END

; SAC 8/21/15 - REMOVED rule-based LDEF adjustment - this now happening inside CSE
;	;*************************************************************************
;	RULELIST "CSE_SimulationPrep_DHWHtr_LDEF" 1 0 0 1
;	;*************************************************************************
;	
;		"Set cseDHWHEATER:LDEFCoefs[1] - a"		cseDHWHEATER:LDEFCoefs[1]	= {	switch (whHeatSrc)
;																											case  1 :	-0.098311	; Gas, Propane, Oil
;																											case  2 :	-0.91263		; Electric
;																											default :	 0.44189		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[2] - b"		cseDHWHEATER:LDEFCoefs[2]	= {	switch (whHeatSrc)
;																											case  1 :	 0.240182	; Gas, Propane, Oil
;																											case  2 :	 0.94278		; Electric
;																											default :	-0.28361		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[3] - c"		cseDHWHEATER:LDEFCoefs[3]	= {	switch (whHeatSrc)
;																											case  1 :	 1.356491	; Gas, Propane, Oil
;																											case  2 :	 4.31687		; Electric
;																											default :	-0.71673		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[4] - d"		cseDHWHEATER:LDEFCoefs[4]	= {	switch (whHeatSrc)
;																											case  1 :	-0.872446	; Gas, Propane, Oil
;																											case  2 :	-3.42732		; Electric
;																											default :	 1.13480		; Heat Pump
;																										endswitch  }
;	
;		"Convert cseDHWHEATER:whEF into LDEF (load dependent energy factor)"
;				cseDHWHEATER:whEF		= {	( log(HrlyAdjRecovLoad * 24 / 1000) * ((LDEFCoefs[1] * whEF) + LDEFCoefs[2]) ) + ((LDEFCoefs[3] * whEF) + LDEFCoefs[4])  }
;	END


;*************************************************************************
;*************************************************************************

ENDFILE
