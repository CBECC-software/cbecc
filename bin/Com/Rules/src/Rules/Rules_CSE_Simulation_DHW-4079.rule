; -------------------------------------------------------------------------
; Rules pertaining to:   Prep For and Clean-up After each CSE Energy Simulation
; CEC Title-24 Residential Energy Code
; -------------------------------------------------------------------------
; Copyright (c) 2012-2014, California Energy Commission
; Copyright (c) 2012-2014, Wrightsoft Corporation
; All rights reserved.
; Redistribution and use in source and binary forms, with or without modification,
; are permitted provided that the following conditions are met:
; - Redistributions of source code must retain the above copyright notice, this
;   list of conditions and the following disclaimer.
; - Redistributions in binary form must reproduce the above copyright notice, this
;   list of conditions, the following disclaimer in the documentation and/or other
;   materials provided with the distribution.
; - Neither the name of the California Energy Commission nor the names of its
;   contributors may be used to endorse or promote products derived from this
;   software without specific prior written permission.
; DISCLAIMER: THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
; "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
; THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
; NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION,
; WRIGHTSOFT CORPORATION, ITRON, INC. OR ANY OTHER AUTHOR OR COPYRIGHT HOLDER OF
; THIS SOFTWARE (COLLECTIVELY, THE "AUTHORS") BE LIABLE FOR ANY DIRECT, INDIRECT,
; INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
; LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
; OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
; LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
; OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
; ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  EACH LICENSEE AND SUBLICENSEE OF THE
; SOFTWARE AGREES NOT TO ASSERT ANY CLAIM AGAINST ANY OF THE AUTHORS RELATING TO
; THIS SOFTWARE, WHETHER DUE TO PERFORMANCE ISSUES, TITLE OR INFRINGEMENT ISSUES,
; STRICT LIABILITY OR OTHERWISE.
; -------------------------------------------------------------------------


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering DHW objects only
;*************************************************************************

	"Delete all cseDHWLOOPPUMP components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPPUMP   )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPBRANCH components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPBRANCH )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPSEG components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPSEG    )  }	; SAC 10/21/15
	"Delete all cseDHWLOOP components"				Proj:Action = {	DeleteAllComps( cseDHWLOOP       )  }	; SAC 10/21/15
	"Delete all cseDHWHEATER components"			Proj:Action = {	DeleteAllComps( cseDHWHEATER     )  }
	"Delete all cseDHWSYS components"				Proj:Action = {	DeleteAllComps( cseDHWSYS        )  }
	"Delete all DwellUnitDHW components"			Proj:Action = {	DeleteAllComps( DwellUnitDHW     )  }	; SAC 5/11/16

	; SAC 4/25/16 - added creation of DHWMETER obejcts
	"Create site-wide FXHwDHWMETER"		Proj:CSE_FXHwDHWMETER	= {	if (CSEDHWUseMethod < 2) then  UNDEFINED
																							else  CreateComp( cseDHWMETER, "DHWMtrFXMix" )  endif  }
	"Create site-wide WHHwDHWMETER"		Proj:CSE_WHHwDHWMETER	= {	if (CSEDHWUseMethod < 2) then  UNDEFINED
																							else  CreateComp( cseDHWMETER, "DHWMtrWH" )  endif  }

;	Descriptions of DHW system types defined in the Res ACM, appendix E, section E1:
;	--------------------------------------------------------------------------------------------------------------------
;		1	One distribution system with one or multiple water heaters serving a single dwelling unit. The system might include
;			recirculation loops within the dwelling unit.  
;		2	Two water heaters with independent distribution systems serving a single dwelling unit. One or more of the
;			distribution systems may include a recirculation loop within the dwelling unit.  
;		3	One distribution system without recirculation loop and with one or multiple water heaters serving multiple
;			dwelling units.  
;		4	One distribution system with one or multiple recirculation loops and with one or multiple water heaters serving
;			multiple units.  
;	--------------------------------------------------------------------------------------------------------------------

  ; CSE DHWSYS creation & setup
	; SAC 10/26/15 - revised to create cseDHWSYS by DHWSys only for SFam, and (potentially multiple) cseDHWSys objects for each DwellUnitType for MFam
	"Create a CSE DHWSYS for each DHWSys"		DHWSys:cseDHWSYSRef					= {	if (IfValidAnd( SimDHWSys > 0.5 )==0 .OR. (Proj:IsMultiFamily > 0.5 .AND. CentralDHW < 0.5)) then  UNCHANGED
																												else  CreateComp( cseDHWSYS, "dhwsys-" + Local( Name ) )  endif  }
	"Set DHWSys:cseDHWSYSRef:SourceDHWSys"		DHWSys:cseDHWSYSRef:SourceDHWSys	= {	Name  }

	"Call subordinate rulelist to setup MFam DHWSYS objects"		Proj:Action		= {	if (IsMultiFamily < 0.5) then  UNCHANGED
																												else if (CSEDHWUseMethod == 1)
																												then	EvalRulelist( "CSE_SimulationPrep_DHW_MFam_wsUse" )
																												else	EvalRulelist( "CSE_SimulationPrep_DHW_MFam_wsDayUse" )    endif endif  }

	"Call subordinate rulelist to complete setup of DHW objects"	Proj:Action	= {	EvalRulelist( "CSE_SimulationPrep_DHW_part2" )  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_Cleanup_DHW" 1 0 0 1
;*************************************************************************
	"Blast site-wide FXHwDHWMETER"		Proj:CSE_FXHwDHWMETER	= {	if (LocalCompAssigned( CSE_FXHwDHWMETER )) then  DeleteComp()  else  UNCHANGED  endif  }	; SAC 4/25/16
	"Blast site-wide WHHwDHWMETER"		Proj:CSE_WHHwDHWMETER	= {	if (LocalCompAssigned( CSE_WHHwDHWMETER )) then  DeleteComp()  else  UNCHANGED  endif  }

	"Delete all cseDHWLOOPPUMP components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPPUMP   )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPBRANCH components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPBRANCH )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPSEG components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPSEG    )  }	; SAC 10/21/15
	"Delete all cseDHWLOOP components"				Proj:Action = {	DeleteAllComps( cseDHWLOOP )  }	; SAC 10/21/15
	"Delete all cseDHWHEATER components"			Proj:Action = {	DeleteAllComps( cseDHWHEATER )  }	; SAC 7/6/15
	"Delete all cseDHWSYS components"				Proj:Action = {	DeleteAllComps( cseDHWSYS )  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SetDHWUseInclude" 1 0 0 1
	"Set Proj:CSE_DefineName[11]"		Proj:CSE_DefineName[11]		= { "ShwrFLOWF"		 }
	"Set Proj:CSE_DefineName[12]"		Proj:CSE_DefineName[12]		= { "ShwrDRAINHREFF"	 }
	"Set Proj:CSE_DefineName[13]"		Proj:CSE_DefineName[13]		= { "CwshHOTF"			 }
	"Set Proj:CSE_DefineName[14]"		Proj:CSE_DefineName[14]		= { "CwshUSEF"			 }
	"Set Proj:CSE_DefineName[15]"		Proj:CSE_DefineName[15]		= { "FaucHOTF"			 }
	"Set Proj:CSE_DefineName[16]"		Proj:CSE_DefineName[16]		= { "FaucFlowF"		 }
	"Set Proj:CSE_DefineName[17]"		Proj:CSE_DefineName[17]		= { "BathFLOWF"		 }
	"Set Proj:CSE_DefineName[18]"		Proj:CSE_DefineName[18]		= { "BathDRAINHREFF"	 }
	"Set Proj:CSE_DefineName[19]"		Proj:CSE_DefineName[19]		= { "DwshFLOWF"		 }
	"Set Proj:CSE_DefineName[20]"		Proj:CSE_DefineName[20]		= { UNDEFINED  }				; add next here
	"Set Proj:CSE_DefineName[21]"		Proj:CSE_DefineName[21]		= { UNDEFINED  }
	"Set Proj:CSE_DefineName[22]"		Proj:CSE_DefineName[22]		= { UNDEFINED  }
	"Set Proj:CSE_DefineName[23]"		Proj:CSE_DefineName[23]		= { UNDEFINED  }

	"Set Proj:CSE_DefineFloat[11]"	Proj:CSE_DefineFloat[11]	= { Proj:ShwrFLOWF		}
	"Set Proj:CSE_DefineFloat[12]"	Proj:CSE_DefineFloat[12]	= { Proj:ShwrDRAINHREFF	}
	"Set Proj:CSE_DefineFloat[13]"	Proj:CSE_DefineFloat[13]	= { Proj:CwshHOTF			}
	"Set Proj:CSE_DefineFloat[14]"	Proj:CSE_DefineFloat[14]	= { Proj:CwshUSEF			}
	"Set Proj:CSE_DefineFloat[15]"	Proj:CSE_DefineFloat[15]	= { Proj:FaucHOTF			}
	"Set Proj:CSE_DefineFloat[16]"	Proj:CSE_DefineFloat[16]	= { Proj:FaucFlowF		}
	"Set Proj:CSE_DefineFloat[17]"	Proj:CSE_DefineFloat[17]	= { Proj:BathFLOWF		}
	"Set Proj:CSE_DefineFloat[18]"	Proj:CSE_DefineFloat[18]	= { Proj:BathDRAINHREFF	}
	"Set Proj:CSE_DefineFloat[19]"	Proj:CSE_DefineFloat[19]	= { Proj:DwshFLOWF		}
	"Set Proj:CSE_DefineFloat[20]"	Proj:CSE_DefineFloat[20]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[21]"	Proj:CSE_DefineFloat[21]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[22]"	Proj:CSE_DefineFloat[22]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[23]"	Proj:CSE_DefineFloat[23]	= { UNDEFINED  }

	"Set Proj:CSE_DefineType[11]"		Proj:CSE_DefineType[11]		= {	1  }
	"Set Proj:CSE_DefineType[12]"		Proj:CSE_DefineType[12]		= {	1  }
	"Set Proj:CSE_DefineType[13]"		Proj:CSE_DefineType[13]		= {	1  }
	"Set Proj:CSE_DefineType[14]"		Proj:CSE_DefineType[14]		= {	1  }
	"Set Proj:CSE_DefineType[15]"		Proj:CSE_DefineType[15]		= {	1  }
	"Set Proj:CSE_DefineType[16]"		Proj:CSE_DefineType[16]		= {	1  }
	"Set Proj:CSE_DefineType[17]"		Proj:CSE_DefineType[17]		= {	1  }
	"Set Proj:CSE_DefineType[18]"		Proj:CSE_DefineType[18]		= {	1  }
	"Set Proj:CSE_DefineType[19]"		Proj:CSE_DefineType[19]		= {	1  }
	"Set Proj:CSE_DefineType[20]"		Proj:CSE_DefineType[20]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[21]"		Proj:CSE_DefineType[21]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[22]"		Proj:CSE_DefineType[22]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[23]"		Proj:CSE_DefineType[23]		= {	UNDEFINED  }
END

RULELIST "CSE_BlastDHWUseInclude" 1 0 0 1
	"Blast Proj:CSE_DefineName[11]"		Proj:CSE_DefineName[11]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[12]"		Proj:CSE_DefineName[12]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[13]"		Proj:CSE_DefineName[13]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[14]"		Proj:CSE_DefineName[14]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[15]"		Proj:CSE_DefineName[15]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[16]"		Proj:CSE_DefineName[16]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[17]"		Proj:CSE_DefineName[17]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[18]"		Proj:CSE_DefineName[18]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[19]"		Proj:CSE_DefineName[19]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[20]"		Proj:CSE_DefineName[20]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[21]"		Proj:CSE_DefineName[21]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[22]"		Proj:CSE_DefineName[22]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[23]"		Proj:CSE_DefineName[23]		= { UNDEFINED  }

	"Blast Proj:CSE_DefineFloat[11]"		Proj:CSE_DefineFloat[11]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[12]"		Proj:CSE_DefineFloat[12]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[13]"		Proj:CSE_DefineFloat[13]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[14]"		Proj:CSE_DefineFloat[14]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[15]"		Proj:CSE_DefineFloat[15]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[16]"		Proj:CSE_DefineFloat[16]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[17]"		Proj:CSE_DefineFloat[17]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[18]"		Proj:CSE_DefineFloat[18]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[19]"		Proj:CSE_DefineFloat[19]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[20]"		Proj:CSE_DefineFloat[20]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[21]"		Proj:CSE_DefineFloat[21]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[22]"		Proj:CSE_DefineFloat[22]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[23]"		Proj:CSE_DefineFloat[23]	= { UNDEFINED  }

	"Blast Proj:CSE_DefineType[11]"		Proj:CSE_DefineType[11]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[12]"		Proj:CSE_DefineType[12]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[13]"		Proj:CSE_DefineType[13]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[14]"		Proj:CSE_DefineType[14]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[15]"		Proj:CSE_DefineType[15]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[16]"		Proj:CSE_DefineType[16]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[17]"		Proj:CSE_DefineType[17]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[18]"		Proj:CSE_DefineType[18]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[19]"		Proj:CSE_DefineType[19]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[20]"		Proj:CSE_DefineType[20]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[21]"		Proj:CSE_DefineType[21]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[22]"		Proj:CSE_DefineType[22]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[23]"		Proj:CSE_DefineType[23]		= {	UNDEFINED  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_MFam_wsUse" 1 0 0 1
;   Rules to setup DHWSYS objects using old (2013 and earlier) DHW use & gains mechanism
;*************************************************************************
	"Create a CSE DHWSYS for each DwellUnitType-1"		DwellUnitType:cseDHWSYSRefs[1]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 1 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[1] ) < 1) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys1-" + Local( Name ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[1]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[1]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[1]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[1]:SourceDHWSys			= {	DHWSysRef[1]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[1]:wsMult"					DwellUnitType:cseDHWSYSRefs[1]:wsMult					= {	NumAssigningDUs  }

	"Create a CSE DHWSYS for each DwellUnitType-2"		DwellUnitType:cseDHWSYSRefs[2]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 2 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[2] ) < 0.5) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys2-" + Local( Name ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[2]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[2]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[2]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[2]:SourceDHWSys			= {	DHWSysRef[2]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[2]:wsMult"					DwellUnitType:cseDHWSYSRefs[2]:wsMult					= {	NumAssigningDUs  }

	"Create a CSE DHWSYS for each DwellUnitType-3"		DwellUnitType:cseDHWSYSRefs[3]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 3 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[3] ) < 0.5) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys3-" + Local( Name ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[3]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[3]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[3]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[3]:SourceDHWSys			= {	DHWSysRef[3]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[3]:wsMult"					DwellUnitType:cseDHWSYSRefs[3]:wsMult					= {	NumAssigningDUs  }

	"Create a CSE DHWSYS for each DwellUnitType-4"		DwellUnitType:cseDHWSYSRefs[4]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 4 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[4] ) < 0.5) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys4-" + Local( Name ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[4]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[4]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[4]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[4]:SourceDHWSys			= {	DHWSysRef[4]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[4]:wsMult"					DwellUnitType:cseDHWSYSRefs[4]:wsMult					= {	NumAssigningDUs  }

	"Create a CSE DHWSYS for each DwellUnitType-5"		DwellUnitType:cseDHWSYSRefs[5]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 5 .OR.
																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[5] ) < 0.5) then  UNCHANGED
																															else  CreateComp( cseDHWSYS, "dhwsys5-" + Local( Name ) )  endif  }
	"Set DwellUnitType:cseDHWSYSRefs[5]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[5]:SourceDwellUnitType	= {	Name  }
	"Set DwellUnitType:cseDHWSYSRefs[5]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[5]:SourceDHWSys			= {	DHWSysRef[5]:Name  }
	"Set DwellUnitType:cseDHWSYSRefs[5]:wsMult"					DwellUnitType:cseDHWSYSRefs[5]:wsMult					= {	NumAssigningDUs  }
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_MFam_wsDayUse" 1 0 0 1
;   Rules to setup DHWSYS objects using old (2013 and earlier) DHW use & gains mechanism
;*************************************************************************
	"Create DwellUnitDHW children for each DwellUnit"	DwellUnit:Action	= {	if (LocalCompAssigned( DwellUnitTypeRef ) < 1 .OR. Count < 1 .OR.
																											 LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[1] ) < 1) then  UNCHANGED
																										else	CreateChildren( DwellUnitDHW, Count, Name + " DU" )  endif  }
																					;					else	CreateChildren( DwellUnitDHW, Count, Name + " DU", "Setup_DwellUnitDHW", 1 )  endif  }
	"Setup DwellUnitDHW objects"							DwellUnitDHW:Action	= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }

	"Create a CSE DHWSYS for each DwellUnitDHW"				DwellUnitDHW:cseDHWSYSRef								= {	CreateComp( cseDHWSYS, "dhwsys-" + Local( Name ) )  }
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitType"	DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitType	= {	DwellUnitTypeRef:Name  }
; SAC 5/11/16 - DISALLOW multiple DHWSys objects per DwellUnitType
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDHWSys"				DwellUnitDHW:cseDHWSYSRef:SourceDHWSys				= {	DwellUnitTypeRef:DHWSysRef[1]:Name  }
	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW"		DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW		= {	Name  }

	"Set DwellUnitDHW:cseDHWSYSRef:wsCentralDHWSYS"			DwellUnitDHW:cseDHWSYSRef:wsCentralDHWSYS			= {	if (IfValidAnd( DwellUnitTypeRef:DHWSysRef[1]:CentralDHW > 0.5 ))
																																					then	DwellUnitTypeRef:DHWSysRef[1]:cseDHWSYSRef
																																					else	UNDEFINED  endif  }
END

;*************************************************************************
RULELIST "Setup_DwellUnitDHW" 1 0 0 0
;   Rules to setup newly created DwellUnitDHW objects
	"Set DwellUnitDHW:DwellUnitTypeRef"		DwellUnitDHW:DwellUnitTypeRef		= {	Parent( DwellUnitTypeRef )  }
	"Set DwellUnitDHW:NumBedrooms"			DwellUnitDHW:NumBedrooms			= {	if (     IfValidAnd( DwellUnitTypeRef:NumBedrooms > 4.5 )) then  5
																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 3.5 )) then  4
																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 2.5 )) then  3
																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 1.5 )) then  2
																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 0.5 )) then  1
																											else	0  endif endif endif endif endif  }
	"Set DwellUnitDHW:DHWProfileLetter"		DwellUnitDHW:DHWProfileLetter		= {	switch ( mod( CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ), 5 ) )
																												case  1 :  "a"
																												case  2 :  "b"
																												case  3 :  "c"
																												case  4 :  "d"
																												default :  "e"
																											endswitch  }
;	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHW%.0fBR", NumBedrooms )  }								; PRIOR to MFam central DHW fixes ~5/12/16
	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHW%.0fBR%s", NumBedrooms, DHWProfileLetter )  }	; PRIOR to MFam central DHW fixes ~5/12/16
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_part2" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering DHW objects only
;*************************************************************************

	"Set DHWSys:HWSupplyTemp"			DHWSys:HWSupplyTemp		= {	; based on Res ACM App E, Eqn RE-3 description of HW supply temp, combined w/ ACM system types described above
																						if (Proj:IsMultiFamily > 0.5 .AND. CentralDHW > 0.5)
																						then  130
																						else if (Proj:CSEDHWUseMethod == 1)
																						then	124  else  115  endif endif  }		; SAC 4/6/16 - non-MFam/central switched from 124 to 115		; SAC 4/15/16 - restored 124 for old/2013 models (tic #641)

	"Setup cseDHWSYS meters and temperatures"		cseDHWSYS:Action	= {	if (LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																								else	EvalRulelist( "Setup_cseDHWSYS_MetersAndTemperatures", 1 )  endif  }

; THE FOLLOWING RULE SERVES TO RE-DISTRIBUTE ALL PROJECT HW CONSUMPTION EVENLY ACROSS ALL SIMULATED DHWSys OBJECTS
; REMOVE THIS RULE TO SIMULATE HW CONSUMPTION BY DHWSys BASED ON Zone/DwellUnitType SIZES/COUNTS
; SAC 10/24/15 - removed this rule to split DHW load based on dwelling units & area served
; SAC 10/26/15 - following rule WILL NOT WORK AGAIN for MFam, non-central systems, as these systems don't rely on this global parameter
;				"Re-allocate DHWSys:DailyHWConsumption"	DHWSys:DailyHWConsumption	= {	if (SumAll( DHWSys:SimDHWSys ) < 0.5)	then  UNCHANGED
;																													else	Proj:DailyHWConsumption / SumAll( DHWSys:SimDHWSys )  endif  }

	"Set cseDHWSYS:HWUse - HW use"		cseDHWSYS:HWUse		= {	if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																						then	SourceDwellUnitType:DHWDailyConsPerSys
																						else if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																						then	SourceDHWSys:DailyHWConsumption
																						else	0  endif endif  }
	;; SAC 9/1/15 - adjustment added per input from Chip:
	;; 		Hot Water Factor for 2013 RACM modifies gallons/day                                        ;
	;; 		 accounts for reduced waste for single-family recirculating systems                        ;
	;; 		 per Marc Hoeshele 22 Oct 2012                                                             ;
	;; 		HWF = 1.0 for non-recirculating or 0.9 for single-family recirculating                     ;
	;			"Adjust cseDHWSYS:HWUse for single family recirculation"
	;					cseDHWSYS:HWUse	= {	if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNCHANGED
	;													else	switch ( SourceDHWSys:SystemType )
	;																case    4992 :  HWUse * 0.9		; "Recirculation, Non-Demand Control"                          
	;																case    5248 :  HWUse * 0.9		; "Recirculation, Demand Control Push Button"                  
	;																case    5504 :  HWUse * 0.9		; "Recirculation, Demand Control Occupancy/Motion"             
	;																case 8393856 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Push Button"     
	;																case 8394112 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion"
	;																default      :  UNCHANGED
	;															endswitch  endif  }
	; SAC 3/17/16 - replaced above rule which applied waste factor to HWUSE with below that passes that factor directly into the DHWSYS via the new wsWF property
				"Set cseDHWSYS:wsWF (waste factor)"
						cseDHWSYS:wsWF		= {	if (Proj:CSEDHWUseMethod == 1) then  UNDEFINED			; SAC 4/15/16 - prevent specification for old/2013 models (tic #641)
														else if (Proj:IsMultiFamily > 0.5 .AND. IfValidAnd( SourceDHWSys:CentralDHW > 0.5 ) .AND.
																	LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSEDHWUseMethod != 1) then  UNDEFINED		; SAC 5/12/16 - no wsWF for DayUse central DHWSYSs
														else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  1.0
														else	switch ( SourceDHWSys:SystemType )
																	case    4992 :  0.9		; "Recirculation, Non-Demand Control"                          
																	case    5248 :  0.9		; "Recirculation, Demand Control Push Button"                  
																	case    5504 :  0.9		; "Recirculation, Demand Control Occupancy/Motion"             
																	case 8393856 :  0.9		; "(HERS req'd) Recirculation, Demand Control Push Button"     
																	case 8394112 :  0.9		; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion"
																	default      :  1.0
																endswitch  endif endif endif  }

	; SAC 3/17/16 - added logic for Proj:CSEDHWUseMethod
	"Set cseDHWSYS:wsUse_x"				cseDHWSYS:wsUse_x	= {	if (Proj:CSEDHWUseMethod != 1) then  UNDEFINED
																				else	Format( "%g * select( $isWeekend, HWUSEF_WE, default HWUSEF_WD )", HWUse )  endif  }
	; SAC 3/17/16 - new wsDayUse property
	"Set cseDHWSYS:wsDayUse_x"			cseDHWSYS:wsDayUse_x	= {	if (Proj:CSEDHWUseMethod == 1) then  UNDEFINED
																					else if (LocalCompAssigned( SourceDwellUnitDHW ) > 0) then  SourceDwellUnitDHW:CSEDayUseName
																					else if (Proj:IsMultiFamily < 0.5)
																					then	if (     Proj:SimNumBedrooms < 1.5) then "DHW1BR"
																							else if (Proj:SimNumBedrooms < 2.5) then "DHW2BR"
																							else if (Proj:SimNumBedrooms < 3.5) then "DHW3BR"
																							else if (Proj:SimNumBedrooms < 4.5) then "DHW4BR"
																							else                                     "DHW5BR"
																							endif endif endif endif
																					else	UNDEFINED  endif endif endif  }
																		; SAC 5/12/16 - ALL MFam DayUse assignments handled via DwellUnitDHW assignment above
																		;			else if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																		;			then	if (     SourceDwellUnitType:NumBedrooms < 0.5) then "DHW0BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 1.5) then "DHW1BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 2.5) then "DHW2BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 3.5) then "DHW3BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 4.5) then "DHW4BR"
																		;					else                                                 "DHW5BR"
																		;					endif endif endif endif endif
																		;			else	UNDEFINED  endif endif endif  }

  ; delta-T and other formulas related to calculation of (simulation) energy factor by water heater
	"Set Proj:InletMainsWtrTemp"		Proj:InletMainsWtrTemp	= {	CAClimateZoneInletMainsTemp:InletTemp( "ClimateZone", Proj:ClimateZone )  }
	"Set DHWSys:HWDeltaTemp"			DHWSys:HWDeltaTemp		= {	if (IfValidAnd( Proj:InletMainsWtrTemp > 0 )==0) then  10		; ERROR
																						else  HWSupplyTemp - Proj:InletMainsWtrTemp  endif  }

	; SAC 10/27/15 - fix problem where DHWSys:NumAssignedDUFracs not taking into account number of assigned DwellUnits of each DwellUnitType
	"Set DwellUnitType:NumDUsSrvdPerDHWSys"	DwellUnitType:NumDUsSrvdPerDHWSys	= {	DHWSysAssignFrac * NumAssigningDUs  }
	"Set DHWSys:NumAssignedDUFracs"		DHWSys:NumAssignedDUFracs	= {	if (Proj:IsMultiFamily < 0.5) then  Proj:NumDwellingUnits
																								else	SumRevRef( DwellUnitType:DHWSysRef[1], DwellUnitType:NumDUsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[2], DwellUnitType:NumDUsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[3], DwellUnitType:NumDUsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[4], DwellUnitType:NumDUsSrvdPerDHWSys ) +
																										SumRevRef( DwellUnitType:DHWSysRef[5], DwellUnitType:NumDUsSrvdPerDHWSys ) 
																								endif  }

; REVISE THIS RULE TO REFERENCE SERVED CFA, # HEATERS & # DWELLING UNITS FOR MORE SYSTEM-SPECIFIC CFAk VALUE
	; SAC 10/12/15 - revised rule to remove dependence on # DHW heaters and add dependence on # systems (serving same area)
	"Set cseDHWSYS:CFAk - defined in Res ACM, equation RE-5, used to calc SDLMk (std distrib loss mult)"
																cseDHWSYS:CFAk		= {	if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																								then	SourceDwellUnitType:CondFlrArea
																								else if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																								then	if (IfValidAnd( SourceDHWSys:NumAssignedDUFracs > 0 ))
																										then	SourceDHWSys:FloorAreaServed[1] / SourceDHWSys:NumAssignedDUFracs
																										else	0  endif
																								else	0  endif endif  }		; error if = 0
																						; was (prior to 10/26/15):
																						;						else if (Proj:IsMultiFamily > 0.5 .AND. CentralDHW > 0.5 .AND. Proj:NumDwellingUnits > 0)
																						;						then	SumAll( DHWSys:FloorAreaServed[1] ) / Proj:NumDwellingUnits
																						;				;		else if (SumAcrossIf( DHWSys:NumDHWHeaters, DHWSys:SimDHWSys > 0.5 ) > 0.5)
																						;				;		then	SumAll( DHWSys:FloorAreaServed[1] ) / SumAcrossIf( DHWSys:NumDHWHeaters, DHWSys:SimDHWSys > 0.5 )
																						;						else if (IfValidAnd( DHWSys:FloorAreaServed[1] > 0.5 ) .AND. SumAll( DHWSys:SimDHWSys ) > 0.5)
																						;						then	SumAll( DHWSys:FloorAreaServed[1] ) / SumAll( DHWSys:SimDHWSys )
																						;						else	0  endif endif  }		; error if = 0

	; SAC 10/12/15 - added 'min( ..., 2500 )' to forumla (based on e-mail from BAW)
	"Set cseDHWSYS:wsSDLM - Standard distribution loss multiplier (refer to Res ACM App E, eqn RE-5)"
										cseDHWSYS:wsSDLM		= {	if (Proj:IsMultiFamily > 0.5 .AND. IfValidAnd( SourceDHWSys:CentralDHW > 0.5 ) .AND.
																				 LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSEDHWUseMethod != 1) then  UNDEFINED		; SAC 5/12/16 - no wsSDLM for central DHWSYSs
																			else	1.004 + (0.000202 * min( CFAk, 2500 )) -
																							  (0.0000000231 * min( CFAk, 2500 ) * min( CFAk, 2500 ))    endif  }
;										DHWSys:cseDHWSYSRef:wsSDLM		= {	1.1829  }  ; DEBUGGING  1.004 + (0.000202 * cseDHWSYSRef:CFAk) - (0.0000000231 * cseDHWSYSRef:CFAk * cseDHWSYSRef:CFAk)  }
                                                            
	"Set cseDHWSYS:HrlyStdEndUse"		cseDHWSYS:HrlyStdEndUse		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																							then	8.345 * HWUse * SourceDHWSys:HWDeltaTemp / 24
																							else	0  endif  }


	; SAC 9/1/15 - updated DSMs for single family recirculation systems per Marc Hoeschle 22 October 2013     ;
	; Recirculation non-demand control                      9.00   was 7.0                              ;
	; Recirculation demand control, push button             1.60   was 1.15                             ;
	; Recirculation demand control, occupancy/motion        2.40   was 1.3                              ;
	; Recirculation demand control, push button HERS        1.45   was 1.05                             ;
	; Recirculation demand control, occupancy/motion HERS   2.20   was 1.2                              ;
	"Set DHWSys:DistribSysMult - Distribution system multiplier (ACM App R, Table B-2)"
						DHWSys:DistribSysMult	= {	switch (SystemType)
																	case     3840 :	1.0	; "Standard"                                                    ; %WHDIST2013_STD =       
																	case     4096 :	0.9	; "Pipe Insulation, All Lines"                                  ; %WHDIST2013_PIA =       
																	case     4352 :	1.4	; "Insulated and Protected Pipe Below Grade"                    ; %WHDIST2013_IPBG =      
																	case     4608 :	1.05	; "Parallel Piping"                                             ; %WHDIST2013_PP =        
																	case     4992 :	9.0	; "Recirculation, Non-Demand Control"                           ; %WHDIST2013_RND =       
																	case     5248 :	1.6	; "Recirculation, Demand Control Push Button"                   ; %WHDIST2013_RDMan =     
																	case     5504 :	2.4	; "Recirculation, Demand Control Occupancy/Motion"              ; %WHDIST2013_RDAuto =    
														;			case  8388608 :	0.0	; ""                                                            ; %HERS_REQUIRED =        
																	case  8392704 :	0.8	; "(HERS req'd) Pipe Insulation, All Lines"                     ; %WHDIST2013_HERSPIA =   
														;			case  8392960 :	0.0	; "(HERS req'd) Insulated and Protected Pipe Below Grade"       ; %WHDIST2013_HERSIPBG =  
																	case  8393216 :	0.95	; "(HERS req'd) Parallel Piping"                                ; %WHDIST2013_HERSPP =    
														;			case  8393600 :	0.0	; "(HERS req'd) Recirculation, Non-Demand Control"              ; %WHDIST2013_HERSRND =   
																	case  8393856 :	1.45	; "(HERS req'd) Recirculation, Demand Control Push Button"      ; %WHDIST2013_HERSRDMan = 
																	case  8394112 :	2.2	; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion" ; %WHDIST2013_HERSRDAuto =
																	case  8394240 :	0.3	; "(HERS req'd) Point of Use"                                   ; %WHDIST2013_HERSPOU =   
																	case  8394496 :	0.7	; "(HERS req'd) Compact Distribution System"                    ; %WHDIST2013_HERSCDS =   
														;			case     5056 :	0.0	; "Multi-Family Central Recirc Non-Demand Control"              ; %WHDIST2013_CRND =      
														;			case     6336 :	0.0	; "Multi-Family Central Recirc Monitoring"                      ; %WHDIST2013_CRM =       
														;			case     6592 :	0.0	; "Multi-Family Central Demand Recirc (new cons std design)"    ; %WHDIST2013_CRD =       
																	default       :	1.0
																endswitch  }
	"Set cseDHWSYS:wsDSM - Distribution system multiplier (ACM App R, Table B-2)"
						cseDHWSYS:wsDSM	= {	if (Proj:IsMultiFamily > 0.5 .AND. IfValidAnd( SourceDHWSys:CentralDHW > 0.5 ) .AND.
															 LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSEDHWUseMethod != 1) then  UNDEFINED		; SAC 5/12/16 - no wsDSM for central DHWSYSs
														else	if (LocalCompAssigned( SourceDHWSys ) > 0.5) then  SourceDHWSys:DistribSysMult  else  1.0  endif endif  }

	"Set cseDHWSYS:DistribLossMult"		cseDHWSYS:DistribLossMult		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5 .AND. LocalStatus( wsSDLM ) > 0)
																									then	1 + ((wsSDLM - 1) * SourceDHWSys:DistribSysMult)
																									else	1.0  endif  }

// TO DO - account for Monthly solar fractions ??
// TO DO - add in HRDLk (hourly recirculation distribution loss (btu))
	"Set cseDHWSYS:HrlyAdjRecovLoad"		cseDHWSYS:HrlyAdjRecovLoad		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																									then	if (IfValidAnd( SourceDHWSys:SolFracType > 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracAnnRpt > 0)==0)
																											then	(HrlyStdEndUse * DistribLossMult) 
																											else	(HrlyStdEndUse * DistribLossMult) -
																													(HrlyStdEndUse * SourceDHWSys:SolFracAnnRpt) 
																											endif
																									else	0  endif  }		; 0 => error

	; electrical parasitic power representing recirculation pump energy use - only when DHWCalcMethod = "CSE"
	; SAC 10/29/15 - revised logic to INSTALL wsParElec in T24-match mode (was previsouly turned OFF) - but do so w/ a 0.1 multiplier, since T24DHW DLL seems to calculate pump elec @ only 10% of what it should be
	"Set cseDHWSYS:wsParElec"		cseDHWSYS:wsParElec		= {	if (Proj:IsMultiFamily > 0.5 .OR. IfValidAnd( SourceDHWSys:SystemType = 4992 )==0) then  UNDEFINED
																					else if (Proj:DHWCalcMthd == "CSE")		; straight CSE
																					then	40			; 40 Watts continual use for SFam where SystemType = "Recirculation, Non-Demand Control"
																					else	 4			; 10% of what we believe to be the correct value
																					endif endif  }
	"Set cseDHWSYS:wsParElec_x"	cseDHWSYS:wsParElec_x	= {	if (Proj:IsMultiFamily > 0.5 .OR.
																							(IfValidAnd( SourceDHWSys:SystemType = 5248 )==0 .AND. IfValidAnd( SourceDHWSys:SystemType = 8393856 )==0 .AND.
																							 IfValidAnd( SourceDHWSys:SystemType = 5504 )==0 .AND. IfValidAnd( SourceDHWSys:SystemType = 8394112 )==0)) then  UNDEFINED
																else if (Proj:DHWCalcMthd == "CSE")		; straight CSE
																then	"hourval( 1.0, 0.5, 0.6, 0.6, 1.2, 2.4, 4.5, 5.7, 5.4, 4.5, 3.7, 2.8, 2.5, 2.3, 2.1, 1.9, 2.8, 3.2, 3.3, 3.1, 2.7, 2.5, 2.3, 1.5 )"
																else	; 10% of each schedule value above when in T24-match mode, since we believe T24 DLL electric pump results are only 10% of what they should be
																		"hourval( 0.1, 0.05, 0.06, 0.06, 0.12, 0.24, 0.45, 0.57, 0.54, 0.45, 0.37, 0.28, 0.25, 0.23, 0.21, 0.19, 0.28, 0.32, 0.33, 0.31, 0.27, 0.25, 0.23, 0.15 )"
																endif endif  }		; scheduled use for SFam where SystemType = any demand-controlled recirculation


	; cseDHWHEATER & cseDHWTANK setup
	"Create Child cseDHWHEATER - 1"		cseDHWSYS:ChildcseDHWHEATERs[1]	= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) < 1 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[1]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[1]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[1]:whMult		= {	SourceDHWSys:HeaterMult[1]  }

; SAC 9/11/15 - revised logic to create cseDHWTANK objects for heaters of all types except large & small storage (as long as tank vol > 0)
	"Create Child cseDHWTANK - 1"			cseDHWSYS:ChildcseDHWTANKs[1]		= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[1] )==0 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "DHWHeater" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[1]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[1]:TankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[1]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[1]:TankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   endif
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   endif
																										else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[1]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[1]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[1]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[1]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[1]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[1]:wtMult		= {	SourceDHWSys:HeaterMult[1]  }

	"Create Child cseDHWHEATER - 2"		cseDHWSYS:ChildcseDHWHEATERs[2]	= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) < 1 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[2]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[2]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[2]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[2]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[2]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[2]:whMult		= {	SourceDHWSys:HeaterMult[2]  }

	"Create Child cseDHWTANK - 2"			cseDHWSYS:ChildcseDHWTANKs[2]		= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[2] )==0 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "DHWHeater" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[2]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif
																										else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[2]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[2]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[2]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[2]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[2]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[2]:wtMult		= {	SourceDHWSys:HeaterMult[2]  }

	"Create Child cseDHWHEATER - 3"		cseDHWSYS:ChildcseDHWHEATERs[3]	= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) < 1 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[3]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[3]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[3]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[3]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[3]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[3]:whMult		= {	SourceDHWSys:HeaterMult[3]  }

	"Create Child cseDHWTANK - 3"			cseDHWSYS:ChildcseDHWTANKs[3]		= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[3] )==0 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "DHWHeater" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[3]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif
																										else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[3]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[3]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[3]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[3]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[3]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[3]:wtMult		= {	SourceDHWSys:HeaterMult[3]  }

	"Create Child cseDHWHEATER - 4"		cseDHWSYS:ChildcseDHWHEATERs[4]	= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) < 1 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[4]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[4]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[4]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[4]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[4]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[4]:whMult		= {	SourceDHWSys:HeaterMult[4]  }

	"Create Child cseDHWTANK - 4"			cseDHWSYS:ChildcseDHWTANKs[4]		= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[4] )==0 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "DHWHeater" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[4]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif
																										else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[4]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[4]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[4]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[4]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[4]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[4]:wtMult		= {	SourceDHWSys:HeaterMult[4]  }

	"Create Child cseDHWHEATER - 5"		cseDHWSYS:ChildcseDHWHEATERs[5]	= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) < 1 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[5]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[5]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[5]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[5]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[5]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[5]:whMult		= {	SourceDHWSys:HeaterMult[5]  }

	"Create Child cseDHWTANK - 5"			cseDHWSYS:ChildcseDHWTANKs[5]		= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[5] )==0 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "DHWHeater" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[5]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif
																										else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[5]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[5]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[5]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[5]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[5]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[5]:wtMult		= {	SourceDHWSys:HeaterMult[5]  }

	"Create Child cseDHWHEATER - 6"		cseDHWSYS:ChildcseDHWHEATERs[6]	= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) < 1 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else	CreateComp( cseDHWHEATER, "dhwhtr6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[6]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWHEATERs[6]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[6]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWHEATERs[6]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWHEATERs[6]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[6]:whMult		= {	SourceDHWSys:HeaterMult[6]  }

	"Create Child cseDHWTANK - 6"			cseDHWSYS:ChildcseDHWTANKs[6]		= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[6] )==0 .OR.
																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "DHWHeater" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[6]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif
																										else if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
																										then	if (IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 6 ) .OR.
																													(IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 1 )==0)) then  UNCHANGED
																												else	CreateComp( cseDHWTANK, "dhwtnk6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif
																										else	UNCHANGED  endif endif endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[6]:SourceDHWHeater"
				cseDHWSYS:ChildcseDHWTANKs[6]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "DHWHeater" ))
																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[6]:SourceHVACSys"
				cseDHWSYS:ChildcseDHWTANKs[6]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
	"Set cseDHWSYS:ChildcseDHWTANKs[6]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[6]:wtMult		= {	SourceDHWSys:HeaterMult[6]  }

	; SAC 10/21/15 - added DHWLOOP creation
	; SAC 11/10/15 - added check to ensure no loops for MFamDistType = No Loops/Pumps - was causing HUGE elec use in this scenario
	"Create Child cseDHWLOOP"		cseDHWSYS:ChildcseDHWLOOP	= {	if (IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. IfValidAnd( SourceDHWSys:CentralDHW > 0.5 )==0 .OR.
																							 IfValidAnd( SourceDHWSys:MFamDistType > 0.5 )==0 .OR. LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																						else	CreateComp( cseDHWLOOP, "dhwlp-" + LocalRef( SourceDHWSys:Name ) )   endif  }

	"Set cseDHWSYS:NumWaterHeaters"		cseDHWSYS:NumWaterHeaters	= {	SumChildren( cseDHWHEATER:whMult )  }		; SAC 7/18/15
	"Set cseDHWHEATER:HrlyAdjRecovLoad - hourly adjusted recovery load (HARLj in ACM DHW docu)"		; SAC 7/17/15   
					cseDHWHEATER:HrlyAdjRecovLoad	= {	if (cseDHWSYS:NumWaterHeaters < 1) then  0
																	else	cseDHWSYS:HrlyAdjRecovLoad / cseDHWSYS:NumWaterHeaters  endif  }

  ; SAC 12/31/15 - revised logic of following rules to accommodate special handling of DHW heater & tank used to model HVACSys-based air-to-water heat pump DHW heating (tic 560)
  ; SAC 1/13/16 - similar revision as above comment for DHWHeater-source DHW when HeaterElementType = "Heat Pump" and IsHydronic flag set (should only happen in MFam) (tic 560)
	"Call subordinate rulelist to setup remaining cseDHWHEATER properties"
				cseDHWHEATER:Action	= {	     if (LocalCompAssigned( SourceDHWHeater ) > 0.5)
													then  if (IfValidAnd( SourceDHWHeater:HeaterElementType == 3 ) .AND. IfValidAnd( SourceDHWHeater:IsHydronic > 0.5 ))
															then	EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP",  1 )
															else	EvalRulelist( "CSE_SimulationPrep_DHWHtr_DHWHtr",  1 )
															endif
													else if (LocalCompAssigned( SourceHVACSys   ) > 0.5)
													then	if (IfValidAnd( SourceHVACSys:Type = 2 ) .AND. IfValidAnd( SourceHVACSys:HtPumpSysType = 11 ))
															then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP", 1 )
															else	EvalRulelist( "CSE_SimulationPrep_DHWHtr_HVACSys", 1 )  endif
													else  UNCHANGED  endif endif  }

  ; SAC 3/22/16 - set new property indicating whether or not a CSE pre-run is required for each cseDHWHEATER
  ;						based on e-mail from CSB: "PreRun is needed ONLY for SmallStorage, non-ASHPX.  (Supposedly) harmless for all other types"
	"Set cseDHWHEATER:CSEPreRunRequired"	cseDHWHEATER:CSEPreRunRequired	= {	if (IfValidAnd( whType == 1 ) .AND. IfValidAnd( whType != 4 )) then  1  else  0  endif  }
  ; SAC 3/22/16 - set cseDHWSYS:wsCalcMode based on whether or not any child heaters require pre-run
	"Set cseDHWSYS:wsCalcMode based on child cseDHWHEATER objects"		cseDHWSYS:wsCalcMode	= {	if (LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNDEFINED
																																else if (SumChildren( cseDHWHEATER:CSEPreRunRequired ) > 0.5)
																																then  "PreRun"  else  "Simulate"  endif endif  }

	"Set Proj:CSE_DHWPreRunReqd"	Proj:CSE_DHWPreRunReqd	= {	if (SumAll( cseDHWHEATER:CSEPreRunRequired ) > 0.5) then  1  else  0  endif  }		; SAC 3/22/16

	"Call subordinate rulelist to setup remaining cseDHWTANK properties"
				cseDHWTANK:Action		= {	     if (LocalCompAssigned( SourceDHWHeater ) > 0.5) then  EvalRulelist( "CSE_SimulationPrep_DHWTank_DHWHtr",  1 )
													else if (LocalCompAssigned( SourceHVACSys   ) > 0.5) then  EvalRulelist( "CSE_SimulationPrep_DHWTank_HVACSys", 1 )
												   else  UNCHANGED  endif endif  }

	"Call subordinate rulelist to setup remaining cseDHWLOOP properties"
				Proj:Action				= {	if (ComponentCount( cseDHWLOOP ) < 1) then  UNCHANGED
													else	EvalRulelist( "CSE_SimulationPrep_DHWLoop" )  endif  }		; default all via one call


; SAC 8/21/15 - REMOVED rule-based LDEF adjustment - this now happening inside CSE
;	"Call subordinate rulelist to revise whEF of cseDHWHEATER to a Load Dependent Energy Factor (LDEF) - ONLY for Small Storage water heaters"
;				cseDHWHEATER:Action	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc > 0 ) .AND. IfValidAnd( whEF > 0 ))
;													then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_LDEF",  1 )
;													else  UNCHANGED  endif  }
END

;*************************************************************************
RULELIST "Setup_cseDHWSYS_MetersAndTemperatures" 1 0 0 0
	"Set cseDHWSYS:wsElecMtr"			cseDHWSYS:wsElecMtr		= {	Proj:CSE_ElecMETER  }
	"Set cseDHWSYS:wsFuelMtr"			cseDHWSYS:wsFuelMtr		= {	     if (Proj:Fuel_HaveNatGas > 0.5) then  Proj:CSE_NatGasMETER
																						else if (Proj:Fuel_HaveOther  > 0.5) then  Proj:CSE_OtherFuelMETER
																						else  UNDEFINED  endif endif  }

	"Set cseDHWSYS:wsFXHwMtr"			cseDHWSYS:wsFXHwMtr		= {	if (GlobalCompAssigned( Proj:CSE_FXHwDHWMETER ) < 1) then  UNDEFINED		; SAC 4/25/16
																						else	Proj:CSE_FXHwDHWMETER  endif  }
	"Set cseDHWSYS:wsWHHwMtr"			cseDHWSYS:wsWHHwMtr		= {	if (GlobalCompAssigned( Proj:CSE_WHHwDHWMETER ) < 1) then  UNDEFINED
																						else	Proj:CSE_WHHwDHWMETER  endif  }

	"Set cseDHWSYS:wsTUse"				cseDHWSYS:wsTUse			= {	if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
																						else	SourceDHWSys:HWSupplyTemp  endif  }
	; SAC 4/6/16 - added in conjunction w/ CSE 0.796 - related to new HPWH model
	"Set cseDHWSYS:wsTSetpoint"		cseDHWSYS:wsTSetpoint	= {	if (Proj:CSEDHWUseMethod == 1) then  UNDEFINED
																						else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
																						else if (Proj:IsMultiFamily > 0.5 .AND. SourceDHWSys:CentralDHW > 0.5)		; SAC 4/13/16 - revised to 130 for central systems
																						then  130  else  125  endif endif endif  }

	; Solar savings fraction inputs
	"Set cseDHWSYS:wsSSF"		cseDHWSYS:wsSSF		= {	if (SourceDHWSys:SolFracType != 1 .OR. IfValidAnd( SourceDHWSys:SolFracAnn >= 0 )==0) then  UNDEFINED  else  SourceDHWSys:SolFracAnn  endif  }
	"Set cseDHWSYS:wsSSF_x"		cseDHWSYS:wsSSF_x		= {
												if (SourceDHWSys:SolFracType != 2 .OR.
														IfValidAnd( SourceDHWSys:SolFracMon[1]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[2]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[3]  >= 0 )==0 .OR.
														IfValidAnd( SourceDHWSys:SolFracMon[4]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[5]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[6]  >= 0 )==0 .OR.
														IfValidAnd( SourceDHWSys:SolFracMon[7]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[8]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[9]  >= 0 )==0 .OR.
														IfValidAnd( SourceDHWSys:SolFracMon[10] >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[11] >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[12] >= 0 )==0 ) then  UNDEFINED
												else	Format( "choose1( $month, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g )", SourceDHWSys:SolFracMon[1], SourceDHWSys:SolFracMon[2], SourceDHWSys:SolFracMon[3],
																					SourceDHWSys:SolFracMon[4], SourceDHWSys:SolFracMon[5], SourceDHWSys:SolFracMon[6], SourceDHWSys:SolFracMon[7], SourceDHWSys:SolFracMon[8],
																					SourceDHWSys:SolFracMon[9], SourceDHWSys:SolFracMon[10], SourceDHWSys:SolFracMon[11], SourceDHWSys:SolFracMon[12] )
												endif  }
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_DHWHtr" 1 0 0 1
;*************************************************************************
	"Set cseDHWHEATER:whType"
			cseDHWHEATER:whType		= {	if (SourceDHWHeater:HeaterElementType == 5) then  1	; "Heat Pump (2016)" -> "Small Storage"
													else	switch ( SourceDHWHeater:TankType )
																case  0 :	4		; "Boiler"    -> "LargeInstantaneous"
																case  1 :	4		; "Indirect"  -> "LargeInstantaneous"
																case  2 :	4	 	; "Large Instantaneous" 
																case  3 :	;if (Proj:DHWCalcMethod = 2 .AND. SourceDHWHeater:HeaterElementType = 0)	; => "CSE (T24 match)" & Elec fuel
																				;then	1				; kludge to simulate Elec Large storage as Elec Small Storage when DHW mode is "CSE (T24 match)"
																				2		; "Large Storage"   
															;	case  4 :	PostError( "Unable to translate DHWHeater:TankType = 'Large Tankless' (4) to cseDHWHEATER:whType" ) 			; "Large Tankless" 
																case  5 :	3		; "Small Instantaneous" 
																case  6 :	1		; "Small Storage"     
															;	case  7 :	PostError( "Unable to translate DHWHeater:TankType = 'Unfired Storage Tank' (7) to cseDHWHEATER:whType" ) 	; "Unfired Storage Tank" 
																case  8 :	PostError( "Unable to translate DHWHeater:TankType = 'Electric Mini Tank' (8) to cseDHWHEATER:whType" ) 	; "Electric Mini Tank" 
																default :	PostError( "Unable to translate DHWHeater:TankType = 'unrecognized' (%g) to cseDHWHEATER:whType", SourceDHWHeater:TankType )
															endswitch  endif  }
	"Set cseDHWHEATER:whHeatSrc"
			cseDHWHEATER:whHeatSrc	= {	switch ( SourceDHWHeater:HeaterElementType )
														case  0 :	if (SourceDHWHeater:ShowTankLocation > 0.5)
																		then  5		; "Electric Resistance"  -> ResistanceX - switched from Res - SAC 4/14/16
																		else  2		; "Resistance"
																		endif
														case  1 :	1		; "Natural Gas"          -> Fuel
														case  2 :	1		; "Propane"              -> Fuel 
														case  3 :	3		; "Heat Pump"            -> ASHP
														case  4 :	1		; "Oil"                  -> Fuel
														case  5 :	4		; "Heat Pump (2016)"     -> ASHPX		; SAC 3/19/16
														default :	PostError( "Unable to translate DHWHeater:HeaterElementType = 'unrecognized' (%g) to cseDHWHEATER:whHeatSrc", SourceDHWHeater:HeaterElementType )
													endswitch  }
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
	"Set cseDHWHEATER:whFuelMtr"
			cseDHWHEATER:whFuelMtr	= {	if (Proj:StandardsVersion > 2016 .OR. Proj:DRtgRefRunID == 2014)		; SAC 11/9/15  - SAC 4/7/16 - added in RESNET here (tic #631)
													then	switch ( SourceDHWHeater:HeaterElementType )		; SAC 3/24/16 - revised logic to prevent specifying FuelMtr for Elec heaters
																case  0 :	UNDEFINED		; "Electric Resistance"  
																case  3 :	UNDEFINED		; "Heat Pump (2013)" 
																case  5 :	UNDEFINED		; "Heat Pump (2016)" 
																default :	if (     Proj:Fuel_HaveNatGas > 0.5 .AND. GlobalCompAssigned( Proj:CSE_NatGasMETER    )) then  Proj:CSE_NatGasMETER
																				else if (Proj:Fuel_HaveOther  > 0.5 .AND. GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then  Proj:CSE_OtherFuelMETER
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - expected Proj:*METER not found.", Name )  endif endif
															endswitch
													else	switch ( SourceDHWHeater:HeaterElementType )
																case  0 :	UNDEFINED		; "Electric Resistance"   
																case  1 :	if (GlobalCompAssigned( Proj:CSE_NatGasMETER )) then		Proj:CSE_NatGasMETER			; "Natural Gas" 
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - DHWHeater:HeaterElementType = 'Natural Gas' (1) but Proj:CSE_NatGasMETER not defined.", Name )  endif
																case  2 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Propane"   
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - DHWHeater:HeaterElementType = 'Propane' (2) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
																case  3 :	UNDEFINED		; "Heat Pump (2013)" 
																case  4 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Oil" 
																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - DHWHeater:HeaterElementType = 'Oil' (4) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
																case  5 :	UNDEFINED		; "Heat Pump (2016)" 
																default :	UNDEFINED
															endswitch  endif  }

	"Set cseDHWHEATER:whVol"			; SAC 9/10/15
			cseDHWHEATER:whVol	= {	if (IfValidAnd( SourceDHWHeater:TankVolume > 0 ) .AND. SourceDHWHeater:HeaterElementType == 5 .AND. SourceDHWHeater:ASHPType == 1) then  SourceDHWHeater:TankVolume
												else if ((IfValidAnd( SourceDHWHeater:TankType = 3 )==0 .AND. IfValidAnd( SourceDHWHeater:TankType = 6 )==0) .OR.
															IfValidAnd( SourceDHWHeater:TankVolume >= 0 )==0 .OR. SourceDHWHeater:HeaterElementType == 5) then  UNDEFINED
												else  SourceDHWHeater:TankVolume  endif endif  }

	"Set cseDHWHEATER:whEF"
			cseDHWHEATER:whEF		= {	if (IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) .AND. SourceDHWHeater:HeaterElementType == 5 .AND. SourceDHWHeater:ASHPType == 1) then  SourceDHWHeater:EnergyFactor
												else if (SourceDHWHeater:HeaterElementType != 5 .AND. IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) .AND.
															(IfValidAnd( whType = 1 ) .OR. IfValidAnd( whType = 3 )))		; SAC 8/21/15 - only for small instantaneous & storage
												then  SourceDHWHeater:EnergyFactor  else  UNDEFINED  endif endif  }
	"Set cseDHWHEATER:whEff"
			cseDHWHEATER:whEff	= {	if (SourceDHWHeater:HeaterElementType != 5 .AND. IfValidAnd( SourceDHWHeater:EnergyFactor > 0 ) .AND.
													(IfValidAnd( whType = 2 ) .OR. IfValidAnd( whType = 4 )))		; SAC 8/21/15 - only for boiler & large instantaneous & storage
												then  SourceDHWHeater:EnergyFactor  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whHPAF"
			cseDHWHEATER:whHPAF	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc = 3 ))		; SAC 8/21/15 - only for small storage, ASHP
												then  CAClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:ClimateZone )  else  UNDEFINED  endif  }
	; SAC 11/10/15 - added logic to transmit Pilot Energy in Btuh directly into whSBL input
	"Set cseDHWHEATER:whSBL"
			cseDHWHEATER:whSBL	= {	if (IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ) .AND. IfValidAnd( SourceDHWHeater:StandbyLossFrac < 1 ) .AND.
													 IfValidAnd( SourceDHWHeater:TankVolume > 0 ) .AND. IfValidAnd( whType = 2 ))		; SAC 8/21/15 - only for large storage		; SAC 9/8/15 - revised to be based on TankVolume
												then  SourceDHWHeater:StandbyLossFrac * 8.25 * SourceDHWHeater:TankVolume * 70
						; no whSBL modeled for any whType other than LargeStorage - this setting moved to whPilotPwr below
						;						else if (IfValidAnd( whType = 4 ) .AND. IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ))
						;						then	SourceDHWHeater:StandbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
						;						else  UNDEFINED  endif endif  }
												else  UNDEFINED  endif  }
									;				 IfValidAnd( SourceDHWHeater:InputRating > 0 ) .AND. IfValidAnd( SourceDHWHeater:TankType = 3 ))		; SAC 8/21/15 - only for large storage
									;			then  SourceDHWHeater:InputRating * SourceDHWHeater:StandbyLossFrac  else  UNDEFINED  endif  }

	"Set cseDHWHEATER:whPilotPwr"
			cseDHWHEATER:whPilotPwr	= {	if (IfValidAnd( whType = 4 ) .AND. IfValidAnd( SourceDHWHeater:StandbyLossFrac > 0 ) .AND. IfValidAnd( whHeatSrc = 1 ))
													then	SourceDHWHeater:StandbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
													else  UNDEFINED  endif  }

	; SAC 11/10/15 - added whParElec to model Elec Mini Tank elec use
	"Set cseDHWHEATER:whParElec"
			cseDHWHEATER:whParElec	= {	if (IfValidAnd( SourceDHWHeater:AllowElecMiniTank > 0 ) .AND. IfValidAnd( SourceDHWHeater:HasElecMiniTank > 0 ) .AND.
														 IfValidAnd( SourceDHWHeater:ElecMiniTankPower > 0 ) )
													then  SourceDHWHeater:ElecMiniTankPower  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whElecMtr"		cseDHWHEATER:whElecMtr		= {	if (IfValidAnd( whParElec > 0 )) then  Proj:CSE_ElecMETER  else  UNCHANGED  endif  }

; SAC 3/19/16 - DHW input generation for new ASHP detailed model
	"Set cseDHWHEATER:whASHPType"		cseDHWHEATER:whASHPType		= {	if (SourceDHWHeater:HeaterElementType != 5 .OR.
																								 IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0) then  UNDEFINED
																							else	switch ( SourceDHWHeater:ASHPType )
																										case   1: "Generic"				; "Generic"
																										case  11: "AOSmithPHPT60"		; "AO Smith PHPT 60"
																										case  12: "AOSmithPHPT80"		; "AO Smith PHPT 80"
																										case  13: "AOSmithHPTU50"		; "AO Smith HPTU 50"
																										case  14: "AOSmithHPTU66"		; "AO Smith HPTU 66"
																										case  15: "AOSmithHPTU80"		; "AO Smith HPTU 80"
																										case  19: "GE2014StdMode"		; "GE2014 50"
																										case  23: "GE2014StdMode80"	; "GE2014 80"
																										case  21: "RheemHB50"			; "Rheem HB 50"
																										case  16: "Sanden40"				; "Sanden 40"
																										case  17: "Sanden80"				; "Sanden 80"
																										case  22: "Stiebel220E"			; "Stiebel 220E"
																										case  99: if (IfValidAnd( Proj:EnableResearchMode > 0.5 ))
																													 then  "WorstCaseMedium"	; "Worst Case Medium"
																													 else  UNDEFINED  endif
																										default :  UNDEFINED    endswitch  endif  }

	"Set cseDHWHEATER:whResHtPwr"		cseDHWHEATER:whResHtPwr		= {	if (SourceDHWHeater:HeaterElementType != 0 .OR. SourceDHWHeater:ShowTankLocation < 1 .OR.
																								 IfValidAnd( SourceDHWHeater:InputRating > 0 )==0) then  UNDEFINED
																							else	SourceDHWHeater:InputRating  endif  }

	"Set cseDHWHEATER:whZone"			cseDHWHEATER:whZone			= {	if (SourceDHWHeater:ShowTankLocation < 1 .OR.
																								 IfValidAnd( SourceDHWHeater:TankOutside > 0 ) .OR.
																								 LocalCompAssigned( SourceDHWHeater:TankZone ) < 1) then  UNDEFINED
																							else if (LocalCompAssigned( SourceDHWHeater:TankZone:CSE_ZONE ) < 1) then  UNDEFINED
																							else	SourceDHWHeater:TankZone:CSE_ZONE  endif endif  }
	"Set cseDHWHEATER:whTEx_x"			cseDHWHEATER:whTEx_x			= {	if (SourceDHWHeater:ShowTankLocation < 1 .OR. 
																								 LocalCompAssigned( whZone ) > 0) then  UNDEFINED
																							else	"$tDbO"  endif  }
	"Set cseDHWHEATER:whASHPSrcZn"	cseDHWHEATER:whASHPSrcZn	= {	if (SourceDHWHeater:HeaterElementType != 5 .OR.
																								 IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .OR.
																								 IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .OR.
																								 IfValidAnd( SourceDHWHeater:ASHPTSrcOutside > 0 ) .OR.
																								 LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) < 1) then  UNDEFINED
																							else if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone:CSE_ZONE ) < 1) then  UNDEFINED
																							else	SourceDHWHeater:ASHPTSrcZone:CSE_ZONE  endif endif  }
	"Set cseDHWHEATER:whASHPSrcT_x"	cseDHWHEATER:whASHPSrcT_x	= {	if (SourceDHWHeater:HeaterElementType != 5 .OR.
																								 IfValidAnd( SourceDHWHeater:ASHPType > 0 )==0 .OR. 
																								 IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .OR.
																								 LocalCompAssigned( whASHPSrcZn ) > 0) then  UNDEFINED
																							else	"$tDbO"  endif  }
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWTank_DHWHtr" 1 0 0 1
;*************************************************************************
	"Set cseDHWTANK:SurfaceArea"
			cseDHWTANK:SurfaceArea	= {	    DHWTankAreaCoefs:CoefE( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:TankType ) *
													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:TankType ) * pow( SourceDHWHeater:TankVolume, 0.33 ) ) + 
													    DHWTankAreaCoefs:CoefG( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:TankType ) ) *
													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:TankType ) * pow( SourceDHWHeater:TankVolume, 0.33 ) ) + 
													    DHWTankAreaCoefs:CoefG( "Fuel", SourceDHWHeater:HeaterElementType, "TankType", SourceDHWHeater:TankType ) )  }
;	"Set cseDHWTANK:wtUA"
;			cseDHWTANK:wtUA			= {	if (IfValidAnd( SourceDHWHeater:ExtInsulRVal > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:IntInsulRVal > 0 )==0) then  UNDEFINED
;													else	SurfaceArea / (ValidOr( SourceDHWHeater:ExtInsulRVal, 0 ) + ValidOr( SourceDHWHeater:IntInsulRVal, 0 ))
;													endif  }
; SAC 9/10/15 - replace specification of wtUA (above) with wtVol & wtInsulR
	"Set cseDHWTANK:wtVol"			cseDHWTANK:wtVol			= {	if (IfValidAnd( SourceDHWHeater:TankVolume >= 0 ))
																					then  SourceDHWHeater:TankVolume
																					else	UNDEFINED  endif  }
	; SAC 9/11/15 - define minimum wtInsulR as 12
	"Set cseDHWTANK:wtInsulR"		cseDHWTANK:wtInsulR		= {	if (ValidOr( SourceDHWHeater:ExtInsulRVal, 0 ) + ValidOr( SourceDHWHeater:IntInsulRVal, 0 ) > 12)
																					then	ValidOr( SourceDHWHeater:ExtInsulRVal, 0 ) + ValidOr( SourceDHWHeater:IntInsulRVal, 0 )
																					else	12  endif  }
	; SAC 9/11/15 - added rules for wtTEx, wtTTank & wtXLoss
	"Set cseDHWTANK:wtTEx"  		cseDHWTANK:wtTEx  		= {	if (IfValidAnd( SourceDHWHeater:AmbientCond = -1 )) then    75     else  UNDEFINED  endif  }		; if Conditioned
	"Set cseDHWTANK:wtTEx_x"		cseDHWTANK:wtTEx_x		= {	if (IfValidAnd( SourceDHWHeater:AmbientCond =  1 )) then  "$tDbO"  else  UNDEFINED  endif  }		; if Unconditioned
	"Set cseDHWTANK:wtTTank"		cseDHWTANK:wtTTank		= {	Parent( wsTUse )  }
	"Set cseDHWTANK:wtXLoss"		cseDHWTANK:wtXLoss		= {	61.4  }
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_HVACSys" 1 0 0 1
;*************************************************************************
	"Set cseDHWHEATER:whType"
			cseDHWHEATER:whType		= {	switch ( SourceHVACSys:DHWTankType )
														case  0 :	4		; "Boiler"    -> "LargeInstantaneous"
														case  1 :	4		; "Indirect"  -> "LargeInstantaneous"
														case  2 :	4	 	; "Large Instantaneous" 
														case  3 :	;if (Proj:DHWCalcMethod = 2 .AND. SourceHVACSys:DHWHeaterElementType = 0)	; => "CSE (T24 match)" & Elec fuel
																		;then	1				; kludge to simulate Elec Large storage as Elec Small Storage when DHW mode is "CSE (T24 match)"
																		2		; "Large Storage"   
													;	case  4 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Large Tankless' (4) to cseDHWHEATER:whType" ) 		; "Large Tankless" 
														case  5 :	3		; "Small Instantaneous" 
														case  6 :	1		; "Small Storage"     
													;	case  7 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Unfired Storage Tank' (7) to cseDHWHEATER:whType" ) ; "Unfired Storage Tank" 
														case  8 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Electric Mini Tank' (8) to cseDHWHEATER:whType" ) 	; "Electric Mini Tank" 
														default :	PostError( "Unable to translate HVACSys:DHWTankType = 'unrecognized' (%g) to cseDHWHEATER:whType", SourceHVACSys:DHWTankType )
													endswitch  }
	"Set cseDHWHEATER:whHeatSrc"
			cseDHWHEATER:whHeatSrc	= {	switch ( SourceHVACSys:DHWHeaterElementType )
														case  0 :	2		; "Electric Resistance"   
														case  1 :	1		; "Natural Gas"   -> Fuel
														case  2 :	1		; "Propane"       -> Fuel 
														case  3 :	3		; "Heat Pump"     -> ASHP
														case  4 :	1		; "Oil"           -> Fuel
														default :	PostError( "Unable to translate SourceHVACSys:DHWHeaterElementType = 'unrecognized' (%g) to cseDHWHEATER:whHeatSrc", SourceHVACSys:DHWHeaterElementType )
													endswitch  }
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
	"Set cseDHWHEATER:whFuelMtr"
			cseDHWHEATER:whFuelMtr	= {	switch ( SourceHVACSys:DHWHeaterElementType )
														case  0 :	UNDEFINED		; "Electric Resistance"   
														case  1 :	if (GlobalCompAssigned( Proj:CSE_NatGasMETER )) then		Proj:CSE_NatGasMETER			; "Natural Gas" 
																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Natural Gas' (1) but Proj:CSE_NatGasMETER not defined.", Name )  endif
														case  2 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Propane"   
																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Propane' (2) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
														case  3 :	UNDEFINED		; "Heat Pump" 
														case  4 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Oil" 
																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Oil' (4) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
														default :	UNDEFINED
													endswitch  }

	"Set cseDHWHEATER:whVol"			; SAC 9/10/15
			cseDHWHEATER:whVol	= {	if ((IfValidAnd( SourceHVACSys:DHWTankType = 3 )==0 .AND. IfValidAnd( SourceHVACSys:DHWTankType = 6 )==0) .OR. IfValidAnd( SourceHVACSys:DHWTankVolume >= 0 )==0) then  UNDEFINED
												else  SourceHVACSys:DHWTankVolume  endif  }

	"Set cseDHWHEATER:whEF"
			cseDHWHEATER:whEF		= {	if (IfValidAnd( SourceHVACSys:DHWEnergyFactor > 0 ) .AND.
													(IfValidAnd( whType = 1 ) .OR. IfValidAnd( whType = 3 )))		; SAC 8/21/15 - only for small instantaneous & storage
												then  SourceHVACSys:DHWEnergyFactor  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whEff"
			cseDHWHEATER:whEff	= {	if (IfValidAnd( SourceHVACSys:DHWEnergyFactor > 0 ) .AND.
													(IfValidAnd( whType = 2 ) .OR. IfValidAnd( whType = 4 )))		; SAC 8/21/15 - only for large instantaneous & storage
												then  SourceHVACSys:DHWEnergyFactor  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whHPAF"
			cseDHWHEATER:whHPAF	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc = 3 ))		; SAC 8/21/15 - only for small storage, ASHP
												then  CAClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:ClimateZone )  else  UNDEFINED  endif  }
	"Set cseDHWHEATER:whSBL"
			cseDHWHEATER:whSBL	= {	if (IfValidAnd( SourceHVACSys:DHWStandbyLossFrac > 0 ) .AND. IfValidAnd( SourceHVACSys:DHWStandbyLossFrac < 1 ) .AND.
													 IfValidAnd( SourceHVACSys:DHWTankVolume > 0 ) .AND. IfValidAnd( whType = 2 ))		; SAC 8/21/15 - only for large storage		; SAC 9/8/15 - revised to be based on TankVolume
												then  SourceHVACSys:DHWStandbyLossFrac * 8.25 * SourceHVACSys:DHWTankVolume * 70  else  UNDEFINED  endif  }
									;				 IfValidAnd( SourceHVACSys:DHWInputRating > 0 ) .AND. IfValidAnd( SourceHVACSys:DHWTankType = 3 ))		; SAC 8/21/15 - only for large storage
									;			then  SourceHVACSys:DHWInputRating * SourceHVACSys:DHWStandbyLossFrac  else  UNDEFINED  endif  }
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWTank_HVACSys" 1 0 0 1
;*************************************************************************
	"Set cseDHWTANK:SurfaceArea"
			cseDHWTANK:SurfaceArea	= {	    DHWTankAreaCoefs:CoefE( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) *
													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) * pow( SourceHVACSys:DHWTankVolume, 0.33 ) ) + 
													    DHWTankAreaCoefs:CoefG( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) ) *
													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) * pow( SourceHVACSys:DHWTankVolume, 0.33 ) ) + 
													    DHWTankAreaCoefs:CoefG( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) )  }
;	"Set cseDHWTANK:wtUA"
;			cseDHWTANK:wtUA			= {	if (IfValidAnd( SourceHVACSys:DHWExtInsulRVal > 0 )==0 .AND. IfValidAnd( SourceHVACSys:DHWIntInsulRVal > 0 )==0) then  UNDEFINED
;													else	SurfaceArea / (ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 ))
;													endif  }
; SAC 9/10/15 - replace specification of wtUA (above) with wtVol & wtInsulR
	"Set cseDHWTANK:wtVol"			cseDHWTANK:wtVol			= {	if (IfValidAnd( SourceHVACSys:DHWTankVolume >= 0 ))
																					then  SourceHVACSys:DHWTankVolume
																					else	UNDEFINED  endif  }
	; SAC 9/11/15 - define minimum wtInsulR as 12
	"Set cseDHWTANK:wtInsulR"		cseDHWTANK:wtInsulR		= {	if (ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 ) > 12)
																					then	ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 )
																					else	12  endif  }
	; SAC 9/11/15 - added rules for wtTEx, wtTTank & wtXLoss
	"Set cseDHWTANK:wtTEx"  		cseDHWTANK:wtTEx  		= {	if (IfValidAnd( SourceHVACSys:DHWAmbientCond = -1 )) then    75     else  UNDEFINED  endif  }		; if Conditioned
	"Set cseDHWTANK:wtTEx_x"		cseDHWTANK:wtTEx_x		= {	if (IfValidAnd( SourceHVACSys:DHWAmbientCond =  1 )) then  "$tDbO"  else  UNDEFINED  endif  }		; if Unconditioned
	"Set cseDHWTANK:wtTTank"		cseDHWTANK:wtTTank		= {	Parent( wsTUse )  }
	"Set cseDHWTANK:wtXLoss"		cseDHWTANK:wtXLoss		= {	61.4  }
END

; SAC 12/31/15 - DHW input generation kludge to setup CSE DHW inputs for HVACSys-based AirToWater heat pumps
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_AWHP" 1 0 0 1
;*************************************************************************
	"Set cseDHWHEATER:whType"			cseDHWHEATER:whType		= {	1	}		; "Small Storage"     
	"Set cseDHWHEATER:whHeatSrc"		cseDHWHEATER:whHeatSrc	= {	3	}		; ASHP
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
;	"Set cseDHWHEATER:whFuelMtr"		cseDHWHEATER:whFuelMtr	= {	
;	"Set cseDHWHEATER:whVol"			cseDHWHEATER:whVol		= {	
;	"Set cseDHWHEATER:whEF"				cseDHWHEATER:whEF			= {	
;	"Set cseDHWHEATER:whEff"			cseDHWHEATER:whEff		= {	
	"Set cseDHWHEATER:whHPAF"			cseDHWHEATER:whHPAF		= {	1  }
;	"Set cseDHWHEATER:whSBL"			cseDHWHEATER:whSBL		= {	
	"Set cseDHWHEATER:whLDEF"			cseDHWHEATER:whLDEF		= {	3.4  }
END

; SAC 10/21/15 - added DHWLOOP
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoop" 1 0 0 1
;*************************************************************************

	"Set cseDHWLOOP:wlMult"			cseDHWLOOP:wlMult		= {	if (IfValidAnd( SourceDHWSys:NRecircLoops >= 1 ) .AND. IfValidAnd( SourceDHWSys:DisplayNumLoops > 0 ))
																				then  SourceDHWSys:NRecircLoops  else  UNDEFINED  endif  }
	"Set cseDHWLOOP:wlFlow"			cseDHWLOOP:wlFlow		= {	6    }
	"Set cseDHWLOOP:wlFUA"			cseDHWLOOP:wlFUA		= {	2.0  }

	; based on Res ACm table B-3
	"Set cseDHWLOOP:wlTIn1"			cseDHWLOOP:wlTIn1		= {	if (ParentStatus( SourceDHWSys:MFamDistType ) < 1) then  UNDEFINED
																				else	switch ( SourceDHWSys:MFamDistType )
																							case    5056 :  130		; "No Control"
																							case    6336 :  130		; "Demand Control (Standard Design for new construction)"
																							case 8393664 :  130		; "No Control with HERS verification"
																							case 8394944 :  130		; "Demand Control with HERS verification"
																							default      :  UNDEFINED		; others set via expression below
																				endswitch  endif  }
	"Set cseDHWLOOP:wlTIn1_x"		cseDHWLOOP:wlTIn1_x	= {	if (ParentStatus( SourceDHWSys:MFamDistType ) < 1) then  UNDEFINED
																				else if (SourceDHWSys:MFamDistType ==    6592 ||	; "Temperature modulation"
																							SourceDHWSys:MFamDistType == 8395200 )		; "Temperature modulation with HERS verification"
																				then	"hourval( 120, 120, 120, 120, 120, 125, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 125)"
																				else if (SourceDHWSys:MFamDistType ==    6848 ||	; "Temperature modulation & monitoring"
																							SourceDHWSys:MFamDistType == 8395456 )		; "Temperature modulation & monitoring with HERS verification"
																				then	"hourval( 115, 115, 115, 115, 115, 120, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 120)"
																				else	UNDEFINED
																				endif endif endif  }

	; based on Res ACm table B-3
	"Set cseDHWLOOP:wlRunF"			cseDHWLOOP:wlRunF		= {	if (ParentStatus( SourceDHWSys:MFamDistType ) < 1) then  UNDEFINED
																				else	switch ( SourceDHWSys:MFamDistType )
																							case    6336 :  0.2		; "Demand Control (Standard Design for new construction)"
																							case 8394944 :  0.2		; "Demand Control with HERS verification"
																							default      :  1.0		; all others
																				endswitch  endif  }

	; SAC 10/28/15 - added DHWLOOPPUMP creation
	"Create Child cseDHWLOOPPUMP"				cseDHWLOOP:ChildcseDHWLOOPPUMP				= {	if (IfValidAnd( SourceDHWSys:RecircPumpHP > 0 )==0 .OR. IfValidAnd( SourceDHWSys:RecircPumpEff > 0 )==0) then  UNCHANGED
																														else	CreateComp( cseDHWLOOPPUMP, "dhwlppmp-" + ParentRef( SourceDHWSys:Name ) )  endif  }
	"Set ChildcseDHWLOOPPUMP:wlpMult"		cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpMult		= {	UNDEFINED  }
	"Set ChildcseDHWLOOPPUMP:wlpPwr"			cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpPwr		= {	746 * SourceDHWSys:RecircPumpHP / SourceDHWSys:RecircPumpEff  }
	"Set ChildcseDHWLOOPPUMP:wlpElecMtr"	cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpElecMtr	= {	Proj:CSE_ElecMETER  }

	; SAC 10/22/15 - added DHWLOOPSEG creation
	"Create Child cseDHWLOOPSEG-1"					cseDHWLOOP:ChildcseDHWLOOPSEGs[1]		= {	CreateComp( cseDHWLOOPSEG, "dhwlpseg1-" + ParentRef( SourceDHWSys:Name ) )  }
	"Set ChildcseDHWLOOPSEGs[1]:SegmentIndex"		cseDHWLOOP:ChildcseDHWLOOPSEGs[1]:SegmentIndex	= {	1  }
	"Create Child cseDHWLOOPSEG-2"					cseDHWLOOP:ChildcseDHWLOOPSEGs[2]		= {	CreateComp( cseDHWLOOPSEG, "dhwlpseg2-" + ParentRef( SourceDHWSys:Name ) )  }
	"Set ChildcseDHWLOOPSEGs[2]:SegmentIndex"		cseDHWLOOP:ChildcseDHWLOOPSEGs[2]:SegmentIndex	= {	2  }
	"Create Child cseDHWLOOPSEG-3"					cseDHWLOOP:ChildcseDHWLOOPSEGs[3]		= {	CreateComp( cseDHWLOOPSEG, "dhwlpseg3-" + ParentRef( SourceDHWSys:Name ) )  }
	"Set ChildcseDHWLOOPSEGs[3]:SegmentIndex"		cseDHWLOOP:ChildcseDHWLOOPSEGs[3]:SegmentIndex	= {	3  }
	"Create Child cseDHWLOOPSEG-4"					cseDHWLOOP:ChildcseDHWLOOPSEGs[4]		= {	CreateComp( cseDHWLOOPSEG, "dhwlpseg4-" + ParentRef( SourceDHWSys:Name ) )  }
	"Set ChildcseDHWLOOPSEGs[4]:SegmentIndex"		cseDHWLOOP:ChildcseDHWLOOPSEGs[4]:SegmentIndex	= {	4  }
	"Create Child cseDHWLOOPSEG-5"					cseDHWLOOP:ChildcseDHWLOOPSEGs[5]		= {	CreateComp( cseDHWLOOPSEG, "dhwlpseg5-" + ParentRef( SourceDHWSys:Name ) )  }
	"Set ChildcseDHWLOOPSEGs[5]:SegmentIndex"		cseDHWLOOP:ChildcseDHWLOOPSEGs[5]:SegmentIndex	= {	5  }
	"Create Child cseDHWLOOPSEG-6"					cseDHWLOOP:ChildcseDHWLOOPSEGs[6]		= {	CreateComp( cseDHWLOOPSEG, "dhwlpseg6-" + ParentRef( SourceDHWSys:Name ) )  }
	"Set ChildcseDHWLOOPSEGs[6]:SegmentIndex"		cseDHWLOOP:ChildcseDHWLOOPSEGs[6]:SegmentIndex	= {	6  }

	"Call subordinate rulelist to setup remaining cseDHWLOOPSEG properties"
				Proj:Action		= {	EvalRulelist( "CSE_SimulationPrep_DHWLoopSeg" )  }		; all at once, not called for each individual cseDHWLOOPSEG
END

; SAC 10/22/15 - added DHWLOOPSEG
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoopSeg" 1 0 0 1
;*************************************************************************
	; SegmentIndex must already set
	"Set cseDHWLOOPSEG:wgTy"			cseDHWLOOPSEG:wgTy			= {	if (IfValidAnd( SegmentIndex > 3 ))
																							then	2		; demand
																							else	1		; supply
																							endif  }
	; based on Res ACM method WH-LOOPSZ
	"Set cseDHWLOOPSEG:NUnitThisSeg"	cseDHWLOOPSEG:NUnitThisSeg	= {	if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0 .OR. IfValidAnd( wlMult > 0 )==0) then  -1  ; ERROR
																							else if (IfValidAnd( SegmentIndex < 4 )==0) then  0		; no NUnit... for segments 4-6
																							else if (IfValidAnd( SegmentIndex < 3 ))
																							then	SourceDHWSys:NumDUsServed / wlMult
																							else	SourceDHWSys:NumDUsServed / wlMult / 2
																							endif endif endif  }
	"Set cseDHWLOOPSEG:wgSize"			cseDHWLOOPSEG:wgSize			= {	if (IfValidAnd( SegmentIndex > 3 ))
																							then	; RETURN pipe segments
																									if (IfValidAnd( Proj:NumStories > 4 ))
																									then	1.0
																									else	0.75
																									endif
																							else	; SUPPLY pipe segments
																									if (IfValidAnd( NUnitThisSeg > 0 ))
																									then	CAResDHW_LoopPipeSize:PipeDiam( "CodeBase", Proj:StdDesignBase, "NUnit", NUnitThisSeg, "IsBranch", "No" )
																									else	UNDEFINED		; error
																									endif
																							endif  }
	; based on Res ACM method WH-LOOPLEN
	"Set Proj:AvgFloorHeight"			Proj:AvgFloorHeight			= {	if (	ValidOr( MaxAll( cseZONE:znEaveZ ), 0 ) > 0 .AND.
																									ValidOr( MinAll( cseZONE:znEaveZ ), 1000 ) < 1000 .AND.
																									IfValidAnd( NumStories > 0 ) )
																							then	( MaxAll( cseZONE:znEaveZ ) - MinAll( cseZONE:znEaveZ ) ) / NumStories
																							else	1		; error
																							endif  }
	"Set cseDHWLOOPSEG:AvgDULen"		cseDHWLOOPSEG:AvgDULen		= {	if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0) then  0		; error
																							else	sqrt( ValidOr( SourceDHWSys:FloorAreaServed[1], 0 ) / SourceDHWSys:NumDUsServed )
																							endif  }
	"Set cseDHWLOOPSEG:wgLength"		cseDHWLOOPSEG:wgLength		= {	if (IfValidAnd( SegmentIndex = 1 ) .OR. IfValidAnd( SegmentIndex = 6 ))
																							then		8 + ( Proj:AvgFloorHeight * ValidOr( Proj:NumStories, 1 ) / 2 )
																							else	; segment index not 1 or 6
																									if (	IfValidAnd( SourceDHWSys:NumDUsServed >  0 )==0 .OR. 
																											IfValidAnd( SourceDHWSys:NRecircLoops >= 1 )==0 .OR.
																											IfValidAnd( Proj:NumStories           >  0 )==0 ) then  UNDEFINED		; error
																									else	AvgDULen * SourceDHWSys:NumDUsServed /
																											(4 * SourceDHWSys:NRecircLoops * Proj:NumStories)
																									endif
																							endif  }
	"Set cseDHWLOOPSEG:wgInsulThk"	cseDHWLOOPSEG:wgInsulThk	= {	SourceDHWSys:LoopPipeInsulThk  }
	"Set cseDHWLOOPSEG:wgInsulK"		cseDHWLOOPSEG:wgInsulK		= {	0.02167  }
	"Set cseDHWLOOPSEG:wgFNoDraw"		cseDHWLOOPSEG:wgFNoDraw		= {	if (IfValidAnd( SegmentIndex > 0 )==0) then  UNDEFINED
																							else	switch ( SegmentIndex )
																										case  1 :  0.2
																										case  2 :  0.4
																										case  3 :  0.6
																										default :  1.0
																									endswitch  endif  }
	"Set cseDHWLOOPSEG:wgExT"			cseDHWLOOPSEG:wgExT			= {	if (IfValidAnd( SourceDHWSys:RecircPipeLoc[1] >= 0 )==0) then  UNDEFINED
																							else	switch ( SourceDHWSys:RecircPipeLoc[1] )
																										case  0 :  70		; Conditioned
																										case  1 :  70		; Semi-Conditioned
																										default :  UNDEFINED
																									endswitch  endif  }
	"Set cseDHWLOOPSEG:wgExT_x"		cseDHWLOOPSEG:wgExT_x		= {	if (IfValidAnd( SourceDHWSys:RecircPipeLoc[1] >= 0 )==0) then  UNDEFINED
																							else	switch ( SourceDHWSys:RecircPipeLoc[1] )
																										case  2 :  "$TdbO"				; Unconditioned (outdoor)
																										case  3 :  "@Weather.tgrnd"	; Underground (ground)
																										default :  UNDEFINED
																									endswitch  endif  }
	"Set cseDHWLOOPSEG:wgExH"			cseDHWLOOPSEG:wgExH			= {	1.5  }

	; SAC 10/22/15 - added DHWLOOPSEG creation
	"Create Child cseDHWLOOPBRANCH"		cseDHWLOOPSEG:ChildcseDHWLOOPBRANCH		= {	if (IfValidAnd( SegmentIndex = 1 )==0) then  UNDEFINED
																												else	CreateComp( cseDHWLOOPBRANCH, "dhwlpbr-" + Parent2Ref( SourceDHWSys:Name ) )  endif  }
	"Call subordinate rulelist to setup remaining cseDHWLOOPBRANCH properties"
				Proj:Action		= {	EvalRulelist( "CSE_SimulationPrep_DHWLoopBranch" )  }		; all at once, not called for each individual cseDHWLOOPBRANCH
END

; SAC 10/22/15 - added DHWLOOPBRANCH
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoopBranch" 1 0 0 1
;*************************************************************************

	; based on Res ACM method WH-BRNU
	"Set cseDHWLOOPBRANCH:NUnitThisBranch"	
			cseDHWLOOPBRANCH:NUnitThisBranch		= {	if (IfValidAnd( Proj:NumStories > 0 )==0) then  -1  ; ERROR
																	else	Proj:NumStories / 2  endif  }
	; based on Res ACM method WH-BRN
	"Set cseDHWLOOPBRANCH:wbMult"			cseDHWLOOPBRANCH:wbMult			= {	if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0 .OR. NUnitThisBranch <= 0) then  UNDEFINED
																									else	SourceDHWSys:NumDUsServed / NUnitThisBranch  endif  }

	; based on Res ACM method WH-BRSZ
	"Set cseDHWLOOPBRANCH:wbSize"			cseDHWLOOPBRANCH:wbSize			= {	if (IfValidAnd( NUnitThisBranch > 0 ))
																									then	CAResDHW_LoopPipeSize:PipeDiam( "CodeBase", Proj:StdDesignBase, "NUnit", NUnitThisBranch, "IsBranch", "Yes" )
																									else	UNDEFINED		; error
																									endif  }
	; based on Res ACM method WH-BRLEN
	"Set cseDHWLOOPBRANCH:wbLength"		cseDHWLOOPBRANCH:wbLength		= {	4 + ( Proj:AvgFloorHeight * ValidOr( Proj:NumStories, 1 ) / 2 )  }

	"Set cseDHWLOOPBRANCH:wbFlow"			cseDHWLOOPBRANCH:wbFlow			= {	2        }
	"Set cseDHWLOOPBRANCH:wbInsulThk"	cseDHWLOOPBRANCH:wbInsulThk	= {	SourceDHWSys:LoopPipeInsulThk  }
	"Set cseDHWLOOPBRANCH:wbInsulK"		cseDHWLOOPBRANCH:wbInsulK		= {	0.02167  }
	"Set cseDHWLOOPBRANCH:wbExH"			cseDHWLOOPBRANCH:wbExH			= {	1.5      }
	"Set cseDHWLOOPBRANCH:wbExT"			cseDHWLOOPBRANCH:wbExT			= {	70       }

	;	wbFWaste is based on Res ACM method WH-BRWF
	;		wbFWaste = Nwaste * SCHwaste * fVol
	;		NWaste = 19.84 * exp( -0.544 * Nunit,b)               Nunit,b = Nfloor/2
	;		SCHwaste per Table B-4
	;		fVol = 1.4
	;		So 
	"Set cseDHWLOOPBRANCH:wbFWaste_x"	cseDHWLOOPBRANCH:wbFWaste_x	= {	
			Format( "1.4 * 19.84 * exp( -0.544 * %g / 2 ) * hourval( 0.01, 0.02, 0.05, 0.22, 0.25, 0.22, 0.06, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01)", NUnitThisBranch )  }

END

; SAC 8/21/15 - REMOVED rule-based LDEF adjustment - this now happening inside CSE
;	;*************************************************************************
;	RULELIST "CSE_SimulationPrep_DHWHtr_LDEF" 1 0 0 1
;	;*************************************************************************
;	
;		"Set cseDHWHEATER:LDEFCoefs[1] - a"		cseDHWHEATER:LDEFCoefs[1]	= {	switch (whHeatSrc)
;																											case  1 :	-0.098311	; Gas, Propane, Oil
;																											case  2 :	-0.91263		; Electric
;																											default :	 0.44189		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[2] - b"		cseDHWHEATER:LDEFCoefs[2]	= {	switch (whHeatSrc)
;																											case  1 :	 0.240182	; Gas, Propane, Oil
;																											case  2 :	 0.94278		; Electric
;																											default :	-0.28361		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[3] - c"		cseDHWHEATER:LDEFCoefs[3]	= {	switch (whHeatSrc)
;																											case  1 :	 1.356491	; Gas, Propane, Oil
;																											case  2 :	 4.31687		; Electric
;																											default :	-0.71673		; Heat Pump
;																										endswitch  }
;		"Set cseDHWHEATER:LDEFCoefs[4] - d"		cseDHWHEATER:LDEFCoefs[4]	= {	switch (whHeatSrc)
;																											case  1 :	-0.872446	; Gas, Propane, Oil
;																											case  2 :	-3.42732		; Electric
;																											default :	 1.13480		; Heat Pump
;																										endswitch  }
;	
;		"Convert cseDHWHEATER:whEF into LDEF (load dependent energy factor)"
;				cseDHWHEATER:whEF		= {	( log(HrlyAdjRecovLoad * 24 / 1000) * ((LDEFCoefs[1] * whEF) + LDEFCoefs[2]) ) + ((LDEFCoefs[3] * whEF) + LDEFCoefs[4])  }
;	END


;*************************************************************************
;*************************************************************************

ENDFILE
